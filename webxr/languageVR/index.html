<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dutch Language Meetup VR</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <!-- CSS3DRenderer loaded after A-Frame, will use A-Frame's bundled THREE -->
  <script src="https://unpkg.com/three@0.147.0/examples/js/renderers/CSS3DRenderer.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vosk-browser@0.0.8/dist/vosk.js"></script>
  <!-- Slice9 component for rounded corners -->
  <script src="https://unpkg.com/aframe-slice9-component/dist/aframe-slice9-component.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      cursor: crosshair; /* Show crosshair cursor for PC users */
    }

    /* CSS3D UI Elements (will be rendered in 3D space) */
    .css3d-element {
      background: rgba(20, 20, 40, 0.95);
      border: 2px solid rgba(100, 150, 255, 0.6);
      border-radius: 15px;
      padding: 30px;
      color: white;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
    }

    /* Question Display */
    #question-box {
      width: 800px;
      height: 200px;
    }

    #question-dutch {
      font-size: 32px;
      font-weight: 600;
      margin-bottom: 15px;
      line-height: 1.4;
      color: #ffffff;
    }

    #question-english {
      font-size: 20px;
      font-style: italic;
      color: #88aaff;
      opacity: 0;
      transition: opacity 0.3s;
      margin-top: 10px;
    }

    #question-box:hover #question-english {
      opacity: 1;
    }

    .repeat-btn {
      background: rgba(100, 150, 255, 0.4);
      border: 2px solid rgba(100, 150, 255, 0.8);
      color: white;
      padding: 12px 30px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 18px;
      margin-top: 15px;
      transition: all 0.3s;
    }

    .repeat-btn:hover {
      background: rgba(100, 150, 255, 0.7);
      transform: scale(1.05);
    }

    /* Answer Choices Container */
    #answer-choices {
      width: 1400px;
      display: flex;
      gap: 30px;
      justify-content: center;
    }

    .answer-card {
      background: rgba(30, 30, 60, 0.95);
      border: 2px solid rgba(80, 120, 200, 0.6);
      border-radius: 12px;
      padding: 30px;
      cursor: pointer;
      transition: all 0.3s;
      flex: 1;
      min-width: 300px;
    }

    .answer-card:hover {
      background: rgba(50, 70, 120, 0.95);
      border-color: rgba(100, 150, 255, 0.9);
      transform: scale(1.05);
      box-shadow: 0 10px 40px rgba(100, 150, 255, 0.4);
    }

    .answer-dutch {
      color: #ffffff;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .answer-english {
      color: #88aaff;
      font-size: 18px;
      font-style: italic;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .answer-card:hover .answer-english {
      opacity: 1;
    }

    /* Mic Visualizer */
    #mic-container {
      width: 600px;
      display: none;
      flex-direction: column;
      align-items: center;
      background: rgba(20, 20, 40, 0.95);
      border: 2px solid rgba(255, 50, 100, 0.6);
      border-radius: 15px;
      padding: 20px;
    }

    #mic-container.active {
      display: flex;
    }

    #visualizer {
      width: 500px;
      height: 200px;
      background: rgba(10, 10, 20, 0.8);
      border-radius: 10px;
      padding: 10px;
    }

    #visualizer path {
      stroke: #ff3366;
      stroke-width: 2;
      fill: none;
    }

    #mic-status {
      color: #ff3366;
      font-size: 20px;
      font-weight: 700;
      margin-top: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    /* Recognition Result */
    #recognition-result {
      width: 700px;
      background: rgba(20, 60, 20, 0.95);
      border: 2px solid rgba(100, 255, 100, 0.6);
      border-radius: 12px;
      padding: 30px;
      display: none;
      text-align: center;
    }

    #recognition-result.show {
      display: block;
    }

    #recognized-text {
      color: #ffffff;
      font-size: 24px;
      margin-bottom: 15px;
    }

    #accuracy-score {
      color: #88ff88;
      font-size: 32px;
      font-weight: bold;
    }

    /* Final Score */
    #final-score {
      width: 800px;
      background: rgba(20, 20, 40, 0.98);
      border: 3px solid rgba(255, 215, 0, 0.8);
      border-radius: 20px;
      padding: 50px;
      display: none;
      text-align: center;
    }

    #final-score.show {
      display: block;
    }

    #final-score h2 {
      color: #ffd700;
      font-size: 40px;
      margin-bottom: 25px;
    }

    #total-accuracy {
      color: #ffffff;
      font-size: 56px;
      font-weight: bold;
      margin: 25px 0;
    }

    #best-score {
      color: #88aaff;
      font-size: 22px;
      margin-top: 20px;
    }

    #restart-btn {
      background: rgba(100, 150, 255, 0.6);
      border: 2px solid rgba(100, 150, 255, 1);
      color: white;
      padding: 20px 50px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 22px;
      margin-top: 25px;
      transition: all 0.3s;
    }

    #restart-btn:hover {
      background: rgba(100, 150, 255, 0.9);
      transform: scale(1.1);
    }

    /* Instructions */
    #instructions {
      width: 1000px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 18px;
      text-align: center;
      background: rgba(0, 0, 0, 0.5);
      padding: 15px 30px;
      border-radius: 10px;
    }

    /* Loading Screen */
    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      transition: opacity 0.5s;
    }

    #loading-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #loading-text {
      color: white;
      font-size: 24px;
      margin-top: 20px;
    }

    #loading-error {
      color: #ff6b6b;
      font-size: 18px;
      margin-top: 15px;
      max-width: 600px;
      text-align: center;
      line-height: 1.6;
    }

    #mic-help {
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
      margin-top: 15px;
      max-width: 500px;
      text-align: left;
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
      line-height: 1.5;
    }

    #mic-help strong {
      color: white;
    }

    #retry-btn {
      background: rgba(100, 150, 255, 0.8);
      border: 2px solid rgba(100, 150, 255, 1);
      color: white;
      padding: 15px 40px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 18px;
      margin-top: 20px;
      transition: all 0.3s;
    }

    #retry-btn:hover {
      background: rgba(100, 150, 255, 1);
      transform: scale(1.05);
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen">
    <div class="spinner"></div>
    <div id="loading-text">Loading Dutch Language Model...</div>
    <div id="loading-error" style="display: none;"></div>
    <div id="mic-help" style="display: none;">
      <strong>How to enable microphone:</strong><br>
      ‚Ä¢ <strong>Quest Browser:</strong> Tap "Allow" when prompted<br>
      ‚Ä¢ <strong>Chrome/Edge:</strong> Click the üîí or üé§ icon in the address bar<br>
      ‚Ä¢ <strong>Firefox:</strong> Click the üõà icon ‚Üí Permissions ‚Üí Microphone ‚Üí Allow<br>
      ‚Ä¢ Then click "Retry" below
    </div>
    <button id="retry-btn" style="display: none;" onclick="DutchApp.retryInit()">üîÑ Retry</button>
  </div>

  <!-- CSS3D UI Elements (hidden containers, will be positioned in 3D) -->
  <div id="css3d-container" style="position: absolute; top: 0; left: 0; pointer-events: none;">
    <!-- Start Button -->
    <div id="start-button" class="css3d-element">
      <h2 style="font-size: 48px; margin-bottom: 20px;">üá≥üá± Dutch Language Practice</h2>
      <p style="font-size: 24px; margin-bottom: 30px;">Learn Dutch through conversation with Maria</p>
      <button class="repeat-btn clickable" onclick="window.DutchApp.startExperience()" style="font-size: 32px; padding: 20px 60px;">
        ‚ñ∂Ô∏è Start Conversation
      </button>
    </div>

    <!-- Question Display -->
    <div id="question-box" class="css3d-element" style="display: none;">
      <div id="question-dutch">Hallo! Hoe gaat het met je?</div>
      <div id="question-english">Hello! How are you?</div>
      <button class="repeat-btn clickable" onclick="window.DutchApp.repeatQuestion()">üîä Repeat</button>
    </div>

    <!-- Answer Choices -->
    <div id="answer-choices" class="css3d-element" style="display: none;">
      <!-- Dynamically populated -->
    </div>

    <!-- Mic Visualizer -->
    <div id="mic-container" class="css3d-element">
      <svg id="visualizer" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 255 255">
        <defs>
          <mask id="mask">
            <g id="maskGroup"></g>
          </mask>
        </defs>
        <rect x="0" y="0" width="255" height="255" fill="#ff3366" mask="url(#mask)" opacity="0.7"></rect>
      </svg>
      <div id="mic-status">üé§ Listening...</div>
    </div>

    <!-- Recognition Result -->
    <div id="recognition-result" class="css3d-element">
      <div id="recognized-text">You said: "..."</div>
      <div id="accuracy-score">85% Match</div>
    </div>

    <!-- Final Score -->
    <div id="final-score" class="css3d-element">
      <h2>üéâ Conversation Complete!</h2>
      <div id="total-accuracy">87%</div>
      <div>Overall Accuracy</div>
      <div id="best-score">Personal Best: 87%</div>
      <button id="restart-btn" class="clickable" onclick="window.DutchApp.restart()">üîÑ Try Again</button>
    </div>

    <!-- Instructions -->
    <div id="instructions" class="css3d-element">
      Hold controller trigger to speak ‚Ä¢ Hover to see translations
    </div>
  </div>

  <!-- A-Frame VR Scene -->
  <a-scene background="color: #FFFFFF" renderer="antialias: true; colorManagement: true">
    <!-- Assets -->
    <a-assets>
      <!-- Restaurant Environment - Modern Dining Room -->
      <a-asset-item id="dining-room-model" src="assets/modern_dining_room.glb"></a-asset-item>
      <!--<a-asset-item id="dining-room-model" src="assets/small_modern_kitchen.glb"></a-asset-item>-->
    </a-assets>

    <!-- Camera Rig with Hands -->
    <a-entity id="camera-rig" position="0 0 0">
      <!-- Camera at eye level -->
      <a-entity 
        id="camera" 
        camera 
        look-controls="pointerLockEnabled: false"
        position="0 1.6 0"
        cursor="rayOrigin: mouse; fuse: false"
        raycaster="objects: .clickable; far: 10">
        <!-- Visual cursor ring for PC mouse users (hidden - not needed) -->
        <a-ring 
          id="mouse-cursor"
          position="0 0 -0.5" 
          radius-inner="0.005" 
          radius-outer="0.008" 
          color="#ffffff" 
          opacity="0.8"
          visible="false">
        </a-ring>
      </a-entity>
      
      <!-- Hands and Controllers (attached to rig so they follow camera) -->
      <a-entity id="left-hand" 
                hand-controls="hand: left; handModelStyle: lowPoly; color: #15ACCF">
      </a-entity>
      <a-entity id="right-hand" 
                hand-controls="hand: right; handModelStyle: lowPoly; color: #15ACCF" 
                laser-controls="hand: right" 
                raycaster="objects: .clickable; far: 10; lineColor: red; lineOpacity: 0.5">
      </a-entity>
    </a-entity>

    <!-- Restaurant Environment (Modern Dining Room) -->
    <a-entity id="environment" position="0 1.5 -3" rotation="0 0 0" scale="1 1 1">
      <a-entity gltf-model="#dining-room-model" shadow="cast: true; receive: true"></a-entity>
    </a-entity>

    <!-- Lighting -->
    <a-entity light="type: ambient; intensity: 0.6"></a-entity>
    <a-entity light="type: directional; intensity: 0.8; castShadow: true" position="2 4 2"></a-entity>
    <a-entity light="type: point; intensity: 0.5; color: #FFA500" position="0 2 -2"></a-entity>

    <!-- Floor -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#8B7355" opacity="0.8" shadow="receive: true" visible="false"></a-plane>

    <!-- NPC Avatar - Maria (in front of user) -->
    <a-entity id="npc" position="0 1.3 -2.5" visible="false">
      <!-- Head -->
      <a-sphere position="0 0.3 0" radius="0.15" color="#FFD4A3"></a-sphere>
      <!-- Body -->
      <a-cylinder position="0 0 0" radius="0.12" height="0.5" color="#4A90E2"></a-cylinder>
      <!-- Arms -->
      <a-cylinder position="-0.2 0.05 0" radius="0.04" height="0.4" rotation="0 0 20" color="#FFD4A3"></a-cylinder>
      <a-cylinder position="0.2 0.05 0" radius="0.04" height="0.4" rotation="0 0 -20" color="#FFD4A3"></a-cylinder>
      <!-- Name label above head -->
      <a-entity position="0 0.6 0">
        <a-text value="Maria" 
                position="0 0 0"
                align="center" 
                color="#ffffff" 
                width="1.5"
                shader="msdf"
                font="assets/fonts/Roboto-Regular-msdf.json"
                negate="false"></a-text>
      </a-entity>
    </a-entity>

    <a-entity id="ui-title-bg" position="0 1.15 -1.5" visible="true">
      <a-sphere color="#FFFFFF" radius="1" position="0 -0.12 0.75" opacity="0.85" side="back" material="transparent: true"></a-sphere>
    </a-entity>

    <!-- UI Panels (A-Frame entities, always visible) -->
    <!-- LocalAllies Logo -->
    <a-entity id="ui-logo" position="-0.15 1.5 -1.5" visible="true">
      <!-- Container for all lines in 3D sphere - will be populated by JavaScript -->
      <a-entity id="logo-lines-container" position="0 0 0"></a-entity>
      <!-- Typography from SVG next to logo - keeping original SVG aspect ratio -->
      <a-image src="assets/Localallies-logo.svg" 
               position="0.25 0 0" 
               height="0.045"
               width="0.25"
               material="transparent: true; opacity: 1"
               shader="flat"></a-image>
    </a-entity>

    <a-entity id="ui-title" position="0 1.15 -1.5" visible="true">
      
      <a-image src="assets/Dutch Language Practice.svg" 
               position="0 0 0" 
               height="0.45"
               width="1"
               material="transparent: true; opacity: 1"
               shader="flat"></a-image>
    </a-entity>

    <!-- Start Button -->
    <a-entity id="ui-start" position="0 0.75 -1.0" visible="true" button-hover>
      <a-box color="#304F4F" width="0.8" height="0.2" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
      <a-text value="Start Conversation" 
              position="0 0 0.006"
              align="center" 
              color="#ffffff" 
              width="0.7"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"
              wrap-count="20"></a-text>
      <a-box class="clickable" width="0.8" height="0.2" depth="0.02" opacity="0" position="0 0 0.02"></a-box>
    </a-entity>

    <!-- Question Panel -->
    <a-entity id="ui-question" position="0 1.0 -1.0" visible="false">
      <a-box color="#E1E9E9" width="0.79" height="0.2" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
      <a-text id="question-text-nl" 
              value="Hoe gaat het?" 
              position="0 0 0.006"
              align="center" 
              color="#000000"
              width="0.575"
              scale="1.2 1.2 1.2"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"
              wrap-count="35"></a-text>
      <!-- English translation tooltip - hidden by default, shown on hover -->
      <a-entity id="question-text-en-container" position="0 -0.175 0.02" visible="false">
        <a-box color="#E1E9E9" width="0.79" height="0.15" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
        <a-text id="question-text-en" 
                value="How are you?" 
                position="0 0 0.02"
                align="center" 
                color="#000000"
                width="0.575"
                scale="1.2 1.2 1.2"
                shader="msdf"
                font="assets/fonts/Roboto-Regular-msdf.json"
                negate="false"
                wrap-count="35"></a-text>
      </a-entity>
      <a-box class="clickable" width="0.79" height="0.2" depth="0.02" opacity="0" position="0 0 0.02"></a-box>
    </a-entity>

    <!-- Answer Panel 1 -->
    <a-entity id="ui-answer1" position="-0.82 0.7 -1.0" visible="false">
      <a-box color="#304F4F" width="0.79" height="0.2" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
      <a-text id="answer1-text" 
              value="Goed" 
              position="0 0 0.006"
              align="center" 
              color="#ffffff" 
              width="0.575"
              scale="1.2 1.2 1.2"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"
              wrap-count="35"></a-text>
      <!-- Best score indicator -->
      <a-text id="answer1-best-score" 
              value="" 
              position="0.35 0.08 0.006"
              align="right" 
              color="#ffffff" 
              width="1.5"
              scale="0.5 0.5 0.5"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"
              transparent="true"
              opacity="1"
              visible="false"></a-text>
      <!-- English translation tooltip -->
      <a-entity id="answer1-en-container" position="0 -0.175 0.006" visible="false">
        <a-box color="#304F4F" width="0.79" height="0.15" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
        <a-text id="answer1-en" 
                value="Good" 
                position="0 0 0.02"
                align="center" 
                color="#ffffff" 
                width="0.575"
                scale="1.2 1.2 1.2"
                shader="msdf"
                font="assets/fonts/Roboto-Regular-msdf.json"
                negate="false"
                wrap-count="35"></a-text>
      </a-entity>
      <a-box class="clickable answer-card" width="0.79" height="0.2" depth="0.02" opacity="0" position="0 0 0.02"></a-box>
    </a-entity>

    <!-- Answer Panel 2 -->
    <a-entity id="ui-answer2" position="0 0.7 -1.0" visible="false">
      <a-box color="#304F4F" width="0.79" height="0.2" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
      <a-text id="answer2-text" 
              value="Prima" 
              position="0 0 0.006"
              align="center" 
              color="#ffffff" 
              width="0.575"
              scale="1.2 1.2 1.2"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"
              wrap-count="35"></a-text>
      <!-- Best score indicator -->
      <a-text id="answer2-best-score" 
              value="" 
              position="0.35 0.08 0.006"
              align="right" 
              color="#ffffff" 
              width="1.5"
              scale="0.5 0.5 0.5"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"
              transparent="true"
              opacity="1"
              visible="false"></a-text>
      <!-- English translation tooltip -->
      <a-entity id="answer2-en-container" position="0 -0.175 0.006" visible="false">
        <a-box color="#304F4F" width="0.79" height="0.15" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
        <a-text id="answer2-en" 
                value="Fine" 
                position="0 0 0.02"
                align="center" 
                color="#ffffff" 
                width="0.575"
                scale="1.2 1.2 1.2"
                shader="msdf"
                font="assets/fonts/Roboto-Regular-msdf.json"
                negate="false"
                wrap-count="35"></a-text>
      </a-entity>
      <a-box class="clickable answer-card" width="0.79" height="0.2" depth="0.02" opacity="0" position="0 0 0.02"></a-box>
    </a-entity>

    <!-- Answer Panel 3 -->
    <a-entity id="ui-answer3" position="0.82 0.7 -1.0" visible="false">
      <a-box color="#304F4F" width="0.79" height="0.2" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
      <a-text id="answer3-text" 
              value="Heel goed" 
              position="0 0 0.006"
              align="center" 
              color="#ffffff" 
              width="0.575"
              scale="1.2 1.2 1.2"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"
              wrap-count="35"></a-text>
      <!-- Best score indicator -->
      <a-text id="answer3-best-score" 
              value="" 
              position="0.35 0.08 0.006"
              align="right" 
              color="#ffffff" 
              width="1.5"
              scale="0.5 0.5 0.5"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"
              transparent="true"
              opacity="1"
              visible="false"></a-text>
      <!-- English translation tooltip -->
      <a-entity id="answer3-en-container" position="0 -0.175 0.006" visible="false">
        <a-box color="#304F4F" width="0.79" height="0.15" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
        <a-text id="answer3-en" 
                value="Very good" 
                position="0 0 0.02"
                align="center" 
                color="#ffffff" 
                width="0.575"
                scale="1.2 1.2 1.2"
                shader="msdf"
                font="assets/fonts/Roboto-Regular-msdf.json"
                negate="false"
                wrap-count="35"></a-text>
      </a-entity>
      <a-box class="clickable answer-card" width="0.79" height="0.2" depth="0.02" opacity="0" position="0 0 0.02"></a-box>
    </a-entity>

    <!--Microphone Visualizer (visible when listening) -->
    <a-entity id="ui-mic-viz" position="0 0.45 -1.0" visible="false">
      <a-box color="#E1E9E9" width="0.79" height="0.2" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
      <a-text value="üé§ Listening..." 
              position="0 0.05 0.02"
              align="center" 
              color="#000000" 
              width="0.7"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"
              wrap-count="60"></a-text>
      <!-- Visual bars for audio levels (will be animated by AudioVisualizer) -->
      <a-entity id="viz-bars" position="-0.16 -0.025 0.04">
        <!-- 8 bars for simple visualization -->
        <a-box id="viz-bar-0" width="0.04" height="0.025" depth="0.02" color="#304F4F" position="0 0 0"></a-box>
        <a-box id="viz-bar-1" width="0.04" height="0.025" depth="0.02" color="#304F4F" position="0.05 0 0"></a-box>
        <a-box id="viz-bar-2" width="0.04" height="0.025" depth="0.02" color="#304F4F" position="0.1 0 0"></a-box>
        <a-box id="viz-bar-3" width="0.04" height="0.025" depth="0.02" color="#304F4F" position="0.15 0 0"></a-box>
        <a-box id="viz-bar-4" width="0.04" height="0.025" depth="0.02" color="#304F4F" position="0.2 0 0"></a-box>
        <a-box id="viz-bar-5" width="0.04" height="0.025" depth="0.02" color="#304F4F" position="0.25 0 0"></a-box>
        <a-box id="viz-bar-6" width="0.04" height="0.025" depth="0.02" color="#304F4F" position="0.3 0 0"></a-box>
        <a-box id="viz-bar-7" width="0.04" height="0.025" depth="0.02" color="#304F4F" position="0.35 0 0"></a-box>
      </a-entity>
    </a-entity>

    <!-- Recognition Result (shown after speech recognition) -->
    <a-entity id="ui-recognition-result" position="0 0.45 -1.0" visible="false">
      <a-box color="#E1E9E9" width="0.79" height="0.2" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
      <a-text id="recognition-text" 
              value="You said: ..." 
              position="0 0.05 0.02"
              align="center" 
              color="#000000" 
              width="0.7"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"
              wrap-count="50"></a-text>
      
      <!-- Left: Retry Button -->
      <a-entity id="retry-answer-button" position="-0.28 -0.05 0.02" button-hover visible="false">
        <a-box id="retry-answer-button-bg" color="#304F4F" width="0.18" height="0.06" depth="0.01" position="0 0 0" opacity="0.9"></a-box>
        <a-text value="Retry" 
                position="0 0 0.006"
                align="center" 
                baseline="center"
                color="#ffffff" 
                width="0.5"
                shader="msdf"
                font="assets/fonts/Roboto-Regular-msdf.json"
                negate="false"></a-text>
        <a-box class="clickable action-btn" width="0.18" height="0.06" depth="0.02" opacity="0" position="0 0 0.02"></a-box>
      </a-entity>
      
      <!-- Center: Accuracy Text -->
      <a-text id="accuracy-text" 
              value="Accuracy: 0%" 
              position="0 -0.05 0.02"
              align="center" 
              color="#000000" 
              width="0.35"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"></a-text>
      
      <!-- Right: Continue Button -->
      <a-entity id="continue-button" position="0.28 -0.05 0.02" button-hover visible="false">
        <a-box id="continue-button-bg" color="#304F4F" width="0.18" height="0.06" depth="0.01" position="0 0 0" opacity="0.9"></a-box>
        <a-text value="Continue" 
                position="0 0 0.006"
                align="center" 
                baseline="center"
                color="#ffffff" 
                width="0.5"
                shader="msdf"
                font="assets/fonts/Roboto-Regular-msdf.json"
                negate="false"></a-text>
        <a-box class="clickable action-btn" width="0.18" height="0.06" depth="0.02" opacity="0" position="0 0 0.02"></a-box>
      </a-entity>
    </a-entity>

    <!-- Final Score (shown at end of conversation) -->
    <a-entity id="ui-final-score" position="0 0.75 -1.0" visible="false">
      <a-box color="#000000" width="1.2" height="0.72" depth="0.01" position="0 0 0" opacity="0.85"></a-box>
      <a-text value="üéâ Conversation Complete!" 
              position="0 0.264 0.02"
              align="center" 
              color="#ffffff" 
              width="1.1"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"></a-text>
      <a-text id="final-accuracy-text" 
              value="Overall Accuracy: 0%" 
              position="0 0.096 0.02"
              align="center" 
              color="#4CAF50" 
              width="1.1"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"></a-text>
      <a-text id="best-score-text" 
              value="Personal Best: 0%" 
              position="0 -0.048 0.02"
              align="center" 
              color="#FFD700" 
              width="1.1"
              shader="msdf"
              font="assets/fonts/Roboto-Regular-msdf.json"
              negate="false"></a-text>
      <!-- Restart Button -->
      <a-entity id="restart-button" position="0 -0.24 0.02" button-hover>
        <a-box id="restart-button-bg" color="#000000" width="0.2" height="0.072" depth="0.01" position="0 0 0" opacity="0.85"></a-box>
        <a-text id="restart-button-text"
                value="Try Again" 
                position="0 0.0048 0.04"
                align="center" 
                baseline="center"
                color="#ffffff" 
                width="0.76"
                scale="2.0 2.0 2.0"
                shader="msdf"
                font="assets/fonts/Roboto-Regular-msdf.json"
                negate="false"
                transparent="true"
                opacity="1"></a-text>
        <a-box class="clickable" width="0.2" height="0.072" depth="0.02" opacity="0" position="0 0 0"></a-box>
      </a-entity>
    </a-entity>

    <!-- Instructions -->
    <a-entity id="ui-instructions" position="0 0.45 -1.0" visible="false">
      <a-text value="Hold trigger to speak" align="center" color="#ffffff" width="0.76"></a-text>
    </a-entity>

    <!-- Controls Row: Mode and Music Toggles -->
    <a-entity id="ui-controls-row" position="0 0.5 -1.0" visible="true">
      <!-- Mode Toggle -->
      <a-entity id="ui-mode-toggle" position="-0.176 0 0">
        <a-entity id="mode-toggle-button" button-hover>
          <a-box id="mode-toggle-button-bg" color="#E1E9E9" width="0.32" height="0.076" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
          <a-text id="mode-toggle-text"
                  value="Mode: Flow" 
                  position="0 0.0048 0.006"
                  align="center" 
                  baseline="center"
                  color="#000000" 
                  width="1.5"
                  scale="0.5 0.5 0.5"
                  shader="msdf"
                  font="assets/fonts/Roboto-Regular-msdf.json"
                  negate="false"
                  transparent="true"
                  opacity="1"></a-text>
          <a-box class="clickable mode-toggle-btn" width="0.32" height="0.076" depth="0.02" opacity="0" position="0 0 0.02"></a-box>
        </a-entity>
      </a-entity>
      
      <!-- Music Toggle -->
      <a-entity id="ui-music-toggle" position="0.176 0 0">
        <a-entity id="music-toggle-button" button-hover>
          <a-box id="music-toggle-button-bg" color="#E1E9E9" width="0.32" height="0.076" depth="0.01" position="0 0 0" opacity="0.8"></a-box>
          <a-text id="music-toggle-text"
                  value="Music: Off" 
                  position="0 0.0048 0.006"
                  align="center" 
                  baseline="center"
                  color="#000000" 
                  width="1.5"
                  scale="0.5 0.5 0.5"
                  shader="msdf"
                  font="assets/fonts/Roboto-Regular-msdf.json"
                  negate="false"
                  transparent="true"
                  opacity="1"></a-text>
          <a-box class="clickable music-toggle-btn" width="0.32" height="0.076" depth="0.02" opacity="0" position="0 0 0.02"></a-box>
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- Menu Button (bottom center - 3 horizontal lines) -->
    <a-entity id="ui-menu-button" position="0 0.2 -1.0" visible="false" button-hover>
      <a-box id="menu-button-bg" color="#000000" width="0.12" height="0.12" depth="0.01" position="0 0 0" opacity="0.85"></a-box>
      <!-- Three horizontal lines -->
      <a-box color="#ffffff" width="0.08" height="0.006" depth="0.001" position="0 0.03 0.02"></a-box>
      <a-box color="#ffffff" width="0.08" height="0.006" depth="0.001" position="0 0 0.02"></a-box>
      <a-box color="#ffffff" width="0.08" height="0.006" depth="0.001" position="0 -0.03 0.02"></a-box>
      <a-box class="clickable menu-btn" width="0.12" height="0.12" depth="0.02" opacity="0" position="0 0 0"></a-box>
    </a-entity>

    <!-- Sky -->
    <a-sky color="#FFFFFF"></a-sky>
  </a-scene>

  <script>
    // ============================================
    // WAIT FOR A-FRAME AND ENSURE THREE.js IS AVAILABLE
    // ============================================
    
    // CSS3DRenderer uses the global THREE from A-Frame
    // A-Frame includes THREE.js, so we don't need to load it separately
    
    // ============================================
    // BUTTON HOVER EFFECT COMPONENT
    // ============================================
    AFRAME.registerComponent('button-hover', {
      init: function () {
        const el = this.el;
        const bgBox = el.querySelector('a-box[color]');
        
        // Get original color from the box element
        if (bgBox) {
          this.originalColor = bgBox.getAttribute('color') || '#000000';
        } else {
          this.originalColor = '#000000';
        }
        this.hoverColor = '#333333';
        
        // Mouse/VR controller hover
        el.addEventListener('mouseenter', () => {
          if (bgBox) {
            bgBox.setAttribute('color', this.hoverColor);
          }
        });
        
        el.addEventListener('mouseleave', () => {
          if (bgBox) {
            bgBox.setAttribute('color', this.originalColor);
          }
        });
        
        // Also listen to raycaster events for VR controllers
        el.addEventListener('raycaster-intersected', () => {
          if (bgBox) {
            bgBox.setAttribute('color', this.hoverColor);
          }
        });
        
        el.addEventListener('raycaster-intersected-cleared', () => {
          if (bgBox) {
            bgBox.setAttribute('color', this.originalColor);
          }
        });
      }
    });
    
    // ============================================
    // HIDE MOUSE CURSOR IN VR MODE
    // ============================================
    AFRAME.registerComponent('hide-in-vr', {
      init: function () {
        const el = this.el;
        const sceneEl = this.el.sceneEl;
        
        // Hide cursor when entering VR
        sceneEl.addEventListener('enter-vr', () => {
          console.log('[Cursor] Entering VR - hiding mouse cursor');
          el.setAttribute('visible', false);
        });
        
        // Show cursor when exiting VR
        sceneEl.addEventListener('exit-vr', () => {
          console.log('[Cursor] Exiting VR - showing mouse cursor');
          el.setAttribute('visible', true);
        });
        
        // Initially hide if already in VR
        if (sceneEl.is('vr-mode')) {
          el.setAttribute('visible', false);
        }
      }
    });
    
    // ============================================
    // CSS3D RENDERER INTEGRATION WITH A-FRAME
    // ============================================
    AFRAME.registerComponent('css3d-ui', {
      init: function () {
        console.log('[CSS3D] Initializing CSS3D renderer...');
        
        // Ensure THREE is available (from A-Frame)
        if (typeof THREE === 'undefined') {
          console.error('[CSS3D] THREE.js not found! A-Frame should provide it.');
          return;
        }
        
        // Ensure CSS3DRenderer is available
        if (typeof THREE.CSS3DRenderer === 'undefined') {
          console.error('[CSS3D] CSS3DRenderer not loaded!');
          return;
        }
        
        const sceneEl = this.el.sceneEl;
        const rendererEl = sceneEl.renderer;
        
        // Create CSS3DRenderer
        this.css3dRenderer = new THREE.CSS3DRenderer();
        this.css3dRenderer.setSize(window.innerWidth, window.innerHeight);
        this.css3dRenderer.domElement.style.position = 'absolute';
        this.css3dRenderer.domElement.style.top = '0';
        this.css3dRenderer.domElement.style.pointerEvents = 'none';
        
        // Insert CSS3D canvas above A-Frame canvas
        const aframeCanvas = sceneEl.canvas;
        aframeCanvas.parentNode.insertBefore(this.css3dRenderer.domElement, aframeCanvas);
        
        // Create CSS3D scene (separate from A-Frame/Three.js scene)
        this.css3dScene = new THREE.Scene();
        
        // Store reference globally for easy access
        window.CSS3DUI = {
          renderer: this.css3dRenderer,
          scene: this.css3dScene,
          objects: {}
        };
        
        console.log('[CSS3D] ‚úì Renderer created');
        
        // Create UI elements in 3D space
        this.createUI();
        
        // Handle window resize
        window.addEventListener('resize', () => {
          this.css3dRenderer.setSize(window.innerWidth, window.innerHeight);
        });
      },
      
      createUI: function () {
        console.log('[CSS3D] Creating 3D UI elements...');
        
        // All UI elements in FRONT of user (negative Z in A-Frame = forward)
        // User at (0, 1.6, 0), looking toward negative Z
        
        // Start Button (center, at eye level, close)
        this.createCSS3DObject('start-button', { x: 0, y: 1.6, z: -1.5 }, 0.0012);
        
        // Question Box (above Maria's head)
        this.createCSS3DObject('question-box', { x: 0, y: 2.2, z: -2.5 }, 0.0012);
        
        // Answer Choices (below Maria, readable distance)
        this.createCSS3DObject('answer-choices', { x: 0, y: 0.9, z: -2 }, 0.001);
        
        // Mic Visualizer (bottom center, close)
        this.createCSS3DObject('mic-container', { x: 0, y: 0.7, z: -1.5 }, 0.0015);
        
        // Recognition Result (center, at eye level)
        this.createCSS3DObject('recognition-result', { x: 0, y: 1.6, z: -2 }, 0.0012);
        
        // Final Score (center, at eye level, close)
        this.createCSS3DObject('final-score', { x: 0, y: 1.6, z: -1.5 }, 0.0012);
        
        // Instructions (bottom, readable)
        this.createCSS3DObject('instructions', { x: 0, y: 0.5, z: -2 }, 0.001);
        
        console.log('[CSS3D] ‚úì UI elements created in 3D space');
      },
      
      createCSS3DObject: function (elementId, position, scale) {
        const element = document.getElementById(elementId);
        if (!element) {
          console.warn('[CSS3D] Element not found:', elementId);
          return;
        }
        
        // Create CSS3D object from HTML element
        const object = new THREE.CSS3DObject(element);
        object.position.set(position.x, position.y, position.z);
        object.scale.set(scale, scale, scale);
        
        // Add to CSS3D scene
        window.CSS3DUI.scene.add(object);
        window.CSS3DUI.objects[elementId] = object;
        
        // Initially hide all except start button
        if (elementId === 'start-button') {
          object.visible = true;
        } else {
          object.visible = false;
        }
        
        // Enable pointer events for buttons
        element.style.pointerEvents = 'auto';
        
        console.log(`[CSS3D] ‚úì Created ${elementId} at (${position.x}, ${position.y}, ${position.z})`);
      },
      
      tick: function () {
        // Render CSS3D on every frame
        if (this.css3dRenderer && this.css3dScene) {
          const camera = this.el.sceneEl.camera;
          this.css3dRenderer.render(this.css3dScene, camera);
        }
      }
    });
    
    // ============================================
    // STRING SIMILARITY HELPER (Levenshtein Distance)
    // ============================================
    function calculateSimilarity(str1, str2) {
      // Normalize strings: lowercase, remove punctuation, trim
      const normalize = (s) => s.toLowerCase().replace(/[.,!?]/g, '').trim();
      const s1 = normalize(str1);
      const s2 = normalize(str2);
      
      // Levenshtein distance algorithm
      const matrix = [];
      const n = s1.length;
      const m = s2.length;

      if (n === 0) return m === 0 ? 100 : 0;
      if (m === 0) return 0;

      for (let i = 0; i <= n; i++) {
        matrix[i] = [i];
      }

      for (let j = 0; j <= m; j++) {
        matrix[0][j] = j;
      }

      for (let i = 1; i <= n; i++) {
        for (let j = 1; j <= m; j++) {
          const cost = s1[i - 1] === s2[j - 1] ? 0 : 1;
          matrix[i][j] = Math.min(
            matrix[i - 1][j] + 1,
            matrix[i][j - 1] + 1,
            matrix[i - 1][j - 1] + cost
          );
        }
      }

      const distance = matrix[n][m];
      const maxLength = Math.max(n, m);
      const similarity = ((maxLength - distance) / maxLength) * 100;
      
      return Math.round(similarity);
    }

    // ============================================
    // VOSK SPEECH RECOGNITION
    // ============================================
    const VoskRecognizer = {
      model: null,
      recognizer: null,
      audioContext: null,
      processor: null,
      analyser: null,
      microphoneStream: null,
      sourceNode: null,
      isInitialized: false,
      isListening: false,
      shouldProcessResults: false,
      onResult: null,
      onPartialResult: null,

      async init(onResult, onPartialResult) {
        console.log('[Vosk] Initializing Dutch model...');
        this.onResult = onResult;
        this.onPartialResult = onPartialResult;
        this.shouldProcessResults = false;

        try {
          const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/'));
          const modelPath = `assets/vosk-models/nl.tar.gz`;
          const fullModelPath = `${baseUrl}/${modelPath}`;

          console.log('[Vosk] Loading model from:', fullModelPath);
          this.model = await Vosk.createModel(fullModelPath);
          console.log('[Vosk] ‚úì Model loaded');

          this.recognizer = new this.model.KaldiRecognizer(16000);
          this.recognizer.setWords(true);
          console.log('[Vosk] ‚úì Recognizer created');

          // Setup audio context
          await this.setupAudio();
          
          this.isInitialized = true;
          console.log('[Vosk] ‚úì Initialization complete');
          return true;
        } catch (error) {
          console.error('[Vosk] Initialization error:', error);
          throw error;
        }
      },

      setupRecognizerEvents() {
        // Set up event listeners for the current recognizer
        this.recognizer.on('result', (message) => {
          // Only process if we should be listening
          if (!this.shouldProcessResults || !this.recognizer) {
            console.log('[Vosk] Ignoring result - not listening');
            return;
          }
          
          console.log('[Vosk] Result event:', message);
          // Access the nested result.text property (Quest-compatible syntax)
          const text = (message.result && message.result.text) || message.text;
          
          // Always call onResult, even for empty results
          // This ensures the UI gets updated and cleanup happens
          if (text && text.trim()) {
            console.log('[Vosk] ‚úì Recognized:', text);
            if (this.onResult) {
              this.onResult(text);
            }
          } else {
            console.log('[Vosk] Empty result (silence or too short)');
            // Still call onResult with empty string so app can clean up
            if (this.onResult) {
              this.onResult('');
            }
          }
        });
        
        this.recognizer.on('partialresult', (message) => {
          // Only process if we should be listening
          if (!this.shouldProcessResults || !this.recognizer) {
            return; // Silent ignore for partials
          }
          
          // Access the nested result.partial property (Quest-compatible syntax)
          const partial = (message.result && message.result.partial) || message.partial;
          if (partial && partial.trim()) {
            console.log('[Vosk] Partial:', partial);
            // Call onPartialResult callback if provided
            if (this.onPartialResult) {
              this.onPartialResult(partial);
            }
          }
        });
      },

      async setupAudio() {
        try {
          // Get microphone stream
          this.microphoneStream = await navigator.mediaDevices.getUserMedia({ 
            audio: {
              echoCancellation: true,
              noiseSuppression: true,
              sampleRate: 16000
            } 
          });
          
          console.log('[Vosk] Microphone access granted');
          
          // Create audio context with 16kHz sample rate (Vosk requirement)
          this.audioContext = new (window.AudioContext || window.webkitAudioContext)({
            sampleRate: 16000
          });
          
          this.sourceNode = this.audioContext.createMediaStreamSource(this.microphoneStream);
          
          // Create analyser for mic level visualization
          this.analyser = this.audioContext.createAnalyser();
          this.analyser.fftSize = 256;
          this.analyser.smoothingTimeConstant = 0.8;
          
          // Create script processor for audio processing
          const bufferSize = 4096;
          this.processor = this.audioContext.createScriptProcessor(bufferSize, 1, 1);
          
          let audioChunkCount = 0;
          
          // Set up initial recognizer events
          this.setupRecognizerEvents();
          
          this.processor.onaudioprocess = (e) => {
            if (!this.isListening || !this.recognizer) return;
            
            audioChunkCount++;
            // Log every 200 chunks (~13 seconds)
            if (audioChunkCount % 200 === 0) {
              console.log('[Vosk] Processing audio chunks...', audioChunkCount);
            }
            
            // Vosk expects the AudioBuffer directly
            try {
              this.recognizer.acceptWaveform(e.inputBuffer);
            } catch (err) {
              console.error('[Vosk] Processing error:', err);
            }
          };
          
          // Connect audio pipeline: source -> analyser -> processor -> destination
          this.sourceNode.connect(this.analyser);
          this.analyser.connect(this.processor);
          this.processor.connect(this.audioContext.destination);
          
          console.log('[Vosk] ‚úì Audio pipeline ready with analyser');
        } catch (error) {
          console.error('[Vosk] Audio setup error:', error);
          throw error;
        }
      },

      start() {
        if (!this.isInitialized) {
          console.error('[Vosk] Not initialized');
          return;
        }

        // Check if already listening before starting
        if (this.isListening) {
          console.warn('[Vosk] Already listening, ensuring flags are synchronized');
          this.shouldProcessResults = true; // Re-enable processing just in case
          return;
        }

        this.isListening = true;
        this.shouldProcessResults = true; // Enable result processing
        console.log('[Vosk] Started listening (recording + processing)');
      },

      stopRecording() {
        // Stop RECORDING new audio, but keep processing enabled for final result
        this.isListening = false;
        console.log('[Vosk] Stopped recording (processing continues)');
        
        // Get final result
        if (this.recognizer) {
          try {
            console.log('[Vosk] Requesting final result...');
            this.recognizer.retrieveFinalResult();
            // The result will come via the 'result' event listener
          } catch (err) {
            console.error('[Vosk] Final result error:', err);
          }
        }
      },

      stop() {
        // Stop everything (recording + processing)
        this.isListening = false;
        this.shouldProcessResults = false;
        console.log('[Vosk] Stopped completely (recording + processing)');
      }
    };

    // ============================================
    // AUDIO VISUALIZER
    // ============================================
    const AudioVisualizer = {
      bars: [],
      isActive: false,
      animationFrame: null,
      updateInterval: null, // Fallback for Quest browser

      init() {
        // Get A-Frame visualizer bars
        this.bars = [];
        for (let i = 0; i < 8; i++) {
          const bar = document.getElementById(`viz-bar-${i}`);
          if (bar) {
            this.bars.push(bar);
          }
        }
        console.log('[Visualizer] Initialized with', this.bars.length, 'bars');
      },

      start() {
        if (!VoskRecognizer.analyser) {
          console.error('[Visualizer] No analyser available');
          return;
        }

        this.isActive = true;
        // Show A-Frame mic visualizer entity
        const micEl = document.getElementById('ui-mic-viz');
        if (micEl) micEl.setAttribute('visible', true);
        console.log('[Visualizer] Started');
        
        // Try both approaches: requestAnimationFrame AND setInterval
        // Quest browser might throttle rAF in VR mode
        this.draw();
        
        // Fallback: Use setInterval for Quest browser (30 FPS)
        this.updateInterval = setInterval(() => {
          if (this.isActive) {
            this.updateBars();
          }
        }, 33); // ~30 FPS
      },

      stop() {
        this.isActive = false;
        // Hide A-Frame mic visualizer entity and show instructions
        const micEl = document.getElementById('ui-mic-viz');
        if (micEl) micEl.setAttribute('visible', false);
        const instructionsEl = document.getElementById('ui-instructions');
        if (instructionsEl) instructionsEl.setAttribute('visible', true);
        
        if (this.animationFrame) {
          cancelAnimationFrame(this.animationFrame);
          this.animationFrame = null;
        }
        
        if (this.updateInterval) {
          clearInterval(this.updateInterval);
          this.updateInterval = null;
        }
        
        console.log('[Visualizer] Stopped');
      },

      draw() {
        if (!this.isActive || !VoskRecognizer.analyser) return;

        this.animationFrame = requestAnimationFrame(() => this.draw());
        this.updateBars();
      },
      
      updateBars() {
        if (!this.isActive || !VoskRecognizer.analyser || this.bars.length === 0) return;

        try {
          const frequencyArray = new Uint8Array(VoskRecognizer.analyser.frequencyBinCount);
          VoskRecognizer.analyser.getByteFrequencyData(frequencyArray);

          // Update each bar's height based on frequency data
          // Sample different frequency ranges for 8 bars
          const barCount = this.bars.length;
          const binSize = Math.floor(frequencyArray.length / barCount);
          
          for (let i = 0; i < barCount; i++) {
            // Average frequency for this bar
            const startBin = i * binSize;
            const endBin = startBin + binSize;
            let sum = 0;
            for (let j = startBin; j < endBin; j++) {
              sum += frequencyArray[j];
            }
            const average = sum / binSize;
            
            // Scale to height (0.05 to 0.3)
            const height = 0.05 + (average / 255) * 0.25;
            
            // Update bar height (batch setAttribute calls)
            if (this.bars[i]) {
              const bar = this.bars[i];
              const yPos = height / 2;
              
              // Use setAttribute sparingly - more efficient
              bar.setAttribute('height', height.toFixed(3));
              bar.object3D.position.y = yPos; // Direct Three.js update (faster)
            }
          }
        } catch (err) {
          console.warn('[Visualizer] Update error (Quest compat):', err.message);
        }
      }
    };

    // ============================================
    // DUTCH CONVERSATION APP
    // ============================================
    window.DutchApp = {
      // Helper functions for A-Frame UI
      showUIElement: function(elementId) {
        const el = document.getElementById(elementId);
        if (el) {
          el.setAttribute('visible', true);
          console.log(`[DutchApp] Showing element: ${elementId}`);
        } else {
          console.warn(`[DutchApp] Element not found: ${elementId}`);
        }
      },
      
      hideUIElement: function(elementId) {
        const el = document.getElementById(elementId);
        if (el) {
          el.setAttribute('visible', false);
          console.log(`[DutchApp] Hiding element: ${elementId}`);
        } else {
          console.warn(`[DutchApp] Element not found to hide: ${elementId}`);
        }
      },
      
      conversations: [
        // ===================================================================
        // WELCOME QUESTIONS (10 varied greetings that lead to conversation groups)
        // ===================================================================
        {
          id: 'welcome-1',
          name: 'Welcome - Friendly Greeting',
          isWelcome: true,
          exchanges: [
            {
              question: {
                dutch: "Hallo! Leuk je te ontmoeten. Hoe gaat het met je?",
                english: "Hello! Nice to meet you. How are you?",
                audio: "assets/audio/nl/welcome/wel1_hoe_gaat_het.mp3"
              },
              answers: [
                { dutch: "Goed, dank je! Ik ben klaar om te oefenen.", english: "Good, thank you! I'm ready to practice.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel1_ans1.mp3" },
                { dutch: "Heel goed! Ik vind het leuk hier te zijn.", english: "Very good! I'm happy to be here.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel1_ans2.mp3" },
                { dutch: "Prima! Laten we beginnen.", english: "Great! Let's get started.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel1_ans3.mp3" }
              ]
            }
          ]
        },
        {
          id: 'welcome-2',
          name: 'Welcome - Enthusiastic',
          isWelcome: true,
          exchanges: [
            {
              question: {
                dutch: "Goedemorgen! Wat fijn dat je er bent. Klaar voor een gesprek?",
                english: "Good morning! How nice that you're here. Ready for a conversation?",
                audio: "assets/audio/nl/welcome/wel2_goedemorgen.mp3"
              },
              answers: [
                { dutch: "Ja, absoluut! Ik kijk er naar uit.", english: "Yes, absolutely! I'm looking forward to it.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel2_ans1.mp3" },
                { dutch: "Heel graag! Laten we Nederlands praten.", english: "Very much! Let's speak Dutch.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel2_ans2.mp3" },
                { dutch: "Zeker weten! Ik ben er klaar voor.", english: "For sure! I'm ready for it.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel2_ans3.mp3" }
              ]
            }
          ]
        },
        {
          id: 'welcome-3',
          name: 'Welcome - Warm',
          isWelcome: true,
          exchanges: [
            {
              question: {
                dutch: "Welkom! Ik ben blij je te zien. Hoe was je dag?",
                english: "Welcome! I'm happy to see you. How was your day?",
                audio: "assets/audio/nl/welcome/wel3_welkom.mp3"
              },
              answers: [
                { dutch: "Heel goed, bedankt! Nu tijd voor Nederlands.", english: "Very good, thanks! Now time for Dutch.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel3_ans1.mp3" },
                { dutch: "Prima! Ik heb er zin in.", english: "Great! I'm excited about it.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel3_ans2.mp3" },
                { dutch: "Druk, maar goed. Laten we praten!", english: "Busy, but good. Let's talk!", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel3_ans3.mp3" }
              ]
            }
          ]
        },
        {
          id: 'welcome-4',
          name: 'Welcome - Casual',
          isWelcome: true,
          exchanges: [
            {
              question: {
                dutch: "H√©! Hoe is het? Zullen we wat Nederlands oefenen?",
                english: "Hey! How's it going? Shall we practice some Dutch?",
                audio: "assets/audio/nl/welcome/wel4_he_hoe.mp3"
              },
              answers: [
                { dutch: "Ja, graag! Ik ben er klaar voor.", english: "Yes, please! I'm ready for it.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel4_ans1.mp3" },
                { dutch: "Super! Laten we beginnen.", english: "Great! Let's begin.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel4_ans2.mp3" },
                { dutch: "Zeker! Waar gaan we het over hebben?", english: "Sure! What are we going to talk about?", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel4_ans3.mp3" }
              ]
            }
          ]
        },
        {
          id: 'welcome-5',
          name: 'Welcome - Polite',
          isWelcome: true,
          exchanges: [
            {
              question: {
                dutch: "Goedendag! Het is een genoegen. Bent u klaar voor onze sessie?",
                english: "Good day! It's a pleasure. Are you ready for our session?",
                audio: "assets/audio/nl/welcome/wel5_goedendag.mp3"
              },
              answers: [
                { dutch: "Jazeker! Heel graag.", english: "Certainly! Very much so.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel5_ans1.mp3" },
                { dutch: "Ja, dank u wel! Laten we starten.", english: "Yes, thank you! Let's start.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel5_ans2.mp3" },
                { dutch: "Absoluut! Ik ben er helemaal klaar voor.", english: "Absolutely! I'm completely ready.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel5_ans3.mp3" }
              ]
            }
          ]
        },
        {
          id: 'welcome-6',
          name: 'Welcome - Evening',
          isWelcome: true,
          exchanges: [
            {
              question: {
                dutch: "Goedenavond! Fijn je weer te zien. Hoe voel je je vandaag?",
                english: "Good evening! Nice to see you again. How are you feeling today?",
                audio: "assets/audio/nl/welcome/wel6_goedenavond.mp3"
              },
              answers: [
                { dutch: "Uitstekend! Klaar voor een gesprek.", english: "Excellent! Ready for a conversation.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel6_ans1.mp3" },
                { dutch: "Goed! Ik heb zin om te oefenen.", english: "Good! I feel like practicing.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel6_ans2.mp3" },
                { dutch: "Prima! Laten we eraan beginnen.", english: "Fine! Let's get started.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel6_ans3.mp3" }
              ]
            }
          ]
        },
        {
          id: 'welcome-7',
          name: 'Welcome - Encouraging',
          isWelcome: true,
          exchanges: [
            {
              question: {
                dutch: "Hallo daar! Je Nederlands wordt elke keer beter. Zullen we verder gaan?",
                english: "Hello there! Your Dutch gets better every time. Shall we continue?",
                audio: "assets/audio/nl/welcome/wel7_wordt_beter.mp3"
              },
              answers: [
                { dutch: "Dank je! Ja, laten we doorgaan.", english: "Thank you! Yes, let's continue.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel7_ans1.mp3" },
                { dutch: "Dat is lief! Ik ben er klaar voor.", english: "That's sweet! I'm ready for it.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel7_ans2.mp3" },
                { dutch: "Mooi! Waar beginnen we?", english: "Great! Where do we start?", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel7_ans3.mp3" }
              ]
            }
          ]
        },
        {
          id: 'welcome-8',
          name: 'Welcome - Cheerful',
          isWelcome: true,
          exchanges: [
            {
              question: {
                dutch: "Dag! Wat leuk dat je er bent. Heb je er zin in?",
                english: "Hi! How nice that you're here. Are you looking forward to it?",
                audio: "assets/audio/nl/welcome/wel8_dag_leuk.mp3"
              },
              answers: [
                { dutch: "Ja, heel veel! Laten we beginnen.", english: "Yes, very much! Let's begin.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel8_ans1.mp3" },
                { dutch: "Zeker! Ik kan niet wachten.", english: "Definitely! I can't wait.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel8_ans2.mp3" },
                { dutch: "Absoluut! Ik ben gemotiveerd.", english: "Absolutely! I'm motivated.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel8_ans3.mp3" }
              ]
            }
          ]
        },
        {
          id: 'welcome-9',
          name: 'Welcome - Relaxed',
          isWelcome: true,
          exchanges: [
            {
              question: {
                dutch: "Hoi! Kom binnen. Zullen we lekker rustig wat Nederlands praten?",
                english: "Hi! Come in. Shall we have a nice relaxed Dutch conversation?",
                audio: "assets/audio/nl/welcome/wel9_hoi_rustig.mp3"
              },
              answers: [
                { dutch: "Ja, dat klinkt goed! Graag.", english: "Yes, that sounds good! Please.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel9_ans1.mp3" },
                { dutch: "Zeker! Ik hou van rustig praten.", english: "Sure! I like speaking calmly.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel9_ans2.mp3" },
                { dutch: "Prima idee! Laten we dat doen.", english: "Great idea! Let's do that.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel9_ans3.mp3" }
              ]
            }
          ]
        },
        {
          id: 'welcome-10',
          name: 'Welcome - Friendly Question',
          isWelcome: true,
          exchanges: [
            {
              question: {
                dutch: "Hallo! Alles goed? Wat wil je vandaag graag oefenen?",
                english: "Hello! All good? What would you like to practice today?",
                audio: "assets/audio/nl/welcome/wel10_wat_oefenen.mp3"
              },
              answers: [
                { dutch: "Alles! Ik wil veel leren.", english: "Everything! I want to learn a lot.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel10_ans1.mp3" },
                { dutch: "Gewoon praten. Conversatie oefenen.", english: "Just talking. Practice conversation.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel10_ans2.mp3" },
                { dutch: "Wat jij wilt! Ik volg jou.", english: "Whatever you want! I'll follow you.", nextGroup: 'random', audio: "assets/audio/nl/welcome/answers/wel10_ans3.mp3" }
              ]
            }
          ]
        },

        // ===================================================================
        // CONVERSATION GROUP 1: HOBBIES & INTERESTS
        // ===================================================================
        {
          id: 'group-hobbies',
          name: 'Conversation - Hobbies & Interests',
          isWelcome: false,
          exchanges: [
            {
              question: {
                dutch: "Wat doe je graag in je vrije tijd?",
                english: "What do you like to do in your free time?",
                audio: "assets/audio/nl/hobbies/hob1_vrije_tijd.mp3"
              },
              answers: [
                { dutch: "Ik hou van lezen. Vooral thrillers en romans.", english: "I love reading. Especially thrillers and novels.", audio: "assets/audio/nl/hobbies/answers/hob1_ans1.mp3" },
                { dutch: "Ik sport veel. Hardlopen en fietsen voornamelijk.", english: "I exercise a lot. Mainly running and cycling.", audio: "assets/audio/nl/hobbies/answers/hob1_ans2.mp3" },
                { dutch: "Ik kook graag. Nieuwe recepten uitproberen is leuk.", english: "I like cooking. Trying new recipes is fun.", audio: "assets/audio/nl/hobbies/answers/hob1_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Dat is interessant! Hoe vaak doe je dat?",
                english: "That's interesting! How often do you do that?",
                audio: "assets/audio/nl/hobbies/hob2_hoe_vaak.mp3"
              },
              answers: [
                { dutch: "Bijna elke dag. Het is mijn passie.", english: "Almost every day. It's my passion.", audio: "assets/audio/nl/hobbies/answers/hob2_ans1.mp3" },
                { dutch: "Een paar keer per week, als ik tijd heb.", english: "A few times a week, when I have time.", audio: "assets/audio/nl/hobbies/answers/hob2_ans2.mp3" },
                { dutch: "In het weekend meestal. Doordeweeks ben ik druk.", english: "Mostly on weekends. I'm busy during the week.", audio: "assets/audio/nl/hobbies/answers/hob2_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Heb je een favoriete artiest of muziekgenre?",
                english: "Do you have a favorite artist or music genre?",
                audio: "assets/audio/nl/hobbies/hob3_muziek.mp3"
              },
              answers: [
                { dutch: "Ik hou van klassieke muziek. Heel ontspannend.", english: "I love classical music. Very relaxing.", audio: "assets/audio/nl/hobbies/answers/hob3_ans1.mp3" },
                { dutch: "Pop en rock vooral. Het geeft me energie.", english: "Mainly pop and rock. It gives me energy.", audio: "assets/audio/nl/hobbies/answers/hob3_ans2.mp3" },
                { dutch: "Allerlei genres! Ik ben niet kieskeurig.", english: "All kinds of genres! I'm not picky.", audio: "assets/audio/nl/hobbies/answers/hob3_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Ga je wel eens naar concerten of festivals?",
                english: "Do you ever go to concerts or festivals?",
                audio: "assets/audio/nl/hobbies/hob4_concerten.mp3"
              },
              answers: [
                { dutch: "Ja, elk jaar! Ik plan altijd van tevoren.", english: "Yes, every year! I always plan ahead.", audio: "assets/audio/nl/hobbies/answers/hob4_ans1.mp3" },
                { dutch: "Soms. Als een goede artiest langskomt.", english: "Sometimes. When a good artist comes by.", audio: "assets/audio/nl/hobbies/answers/hob4_ans2.mp3" },
                { dutch: "Niet echt. Ik luister liever thuis.", english: "Not really. I prefer listening at home.", audio: "assets/audio/nl/hobbies/answers/hob4_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Heb je ook creatieve hobby's? Zoals tekenen of muziek maken?",
                english: "Do you also have creative hobbies? Like drawing or making music?",
                audio: "assets/audio/nl/hobbies/hob5_creatief.mp3"
              },
              answers: [
                { dutch: "Ja! Ik speel gitaar. Al jaren.", english: "Yes! I play guitar. For years already.", audio: "assets/audio/nl/hobbies/answers/hob5_ans1.mp3" },
                { dutch: "Ik fotografeer graag. Vooral natuur en architectuur.", english: "I like photography. Especially nature and architecture.", audio: "assets/audio/nl/hobbies/answers/hob5_ans2.mp3" },
                { dutch: "Niet echt. Ik ben niet zo creatief.", english: "Not really. I'm not very creative.", audio: "assets/audio/nl/hobbies/answers/hob5_ans3.mp3" }
              ]
            }
          ]
        },

        // ===================================================================
        // CONVERSATION GROUP 2: TRAVEL & PLACES
        // ===================================================================
        {
          id: 'group-travel',
          name: 'Conversation - Travel & Places',
          isWelcome: false,
          exchanges: [
            {
              question: {
                dutch: "Reis je graag? Waar ben je recent geweest?",
                english: "Do you like to travel? Where have you been recently?",
                audio: "assets/audio/nl/travel/trav1_reis_graag.mp3"
              },
              answers: [
                { dutch: "Ja, heel graag! Vorige maand was ik in Spanje.", english: "Yes, very much! Last month I was in Spain.", audio: "assets/audio/nl/travel/answers/trav1_ans1.mp3" },
                { dutch: "Ik reis soms. Dit jaar nog niet veel.", english: "I travel sometimes. Not much this year yet.", audio: "assets/audio/nl/travel/answers/trav1_ans2.mp3" },
                { dutch: "Ik ben vorig jaar naar Itali√´ geweest. Prachtig!", english: "I went to Italy last year. Beautiful!", audio: "assets/audio/nl/travel/answers/trav1_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Wat vond je het leukste aan die reis?",
                english: "What did you like best about that trip?",
                audio: "assets/audio/nl/travel/trav2_leukste.mp3"
              },
              answers: [
                { dutch: "Het eten! De lokale gerechten waren verrukkelijk.", english: "The food! The local dishes were delicious.", audio: "assets/audio/nl/travel/answers/trav2_ans1.mp3" },
                { dutch: "De mensen. Iedereen was zo vriendelijk.", english: "The people. Everyone was so friendly.", audio: "assets/audio/nl/travel/answers/trav2_ans2.mp3" },
                { dutch: "De cultuur en geschiedenis. Heel boeiend.", english: "The culture and history. Very fascinating.", audio: "assets/audio/nl/travel/answers/trav2_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Reis je liever naar steden of naar de natuur?",
                english: "Do you prefer traveling to cities or to nature?",
                audio: "assets/audio/nl/travel/trav3_stad_natuur.mp3"
              },
              answers: [
                { dutch: "Steden! Ik hou van musea en restaurants.", english: "Cities! I love museums and restaurants.", audio: "assets/audio/nl/travel/answers/trav3_ans1.mp3" },
                { dutch: "Natuur. Bergen en meren vind ik prachtig.", english: "Nature. I find mountains and lakes beautiful.", audio: "assets/audio/nl/travel/answers/trav3_ans2.mp3" },
                { dutch: "Een mix. Beide hebben hun charme.", english: "A mix. Both have their charm.", audio: "assets/audio/nl/travel/answers/trav3_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Waar wil je graag naartoe in de toekomst?",
                english: "Where would you like to go in the future?",
                audio: "assets/audio/nl/travel/trav4_toekomst.mp3"
              },
              answers: [
                { dutch: "Japan! De cultuur fascineert me enorm.", english: "Japan! The culture fascinates me enormously.", audio: "assets/audio/nl/travel/answers/trav4_ans1.mp3" },
                { dutch: "Nieuw-Zeeland. Voor de natuur en avontuur.", english: "New Zealand. For the nature and adventure.", audio: "assets/audio/nl/travel/answers/trav4_ans2.mp3" },
                { dutch: "Scandinavi√´. Vooral Noorwegen en IJsland.", english: "Scandinavia. Especially Norway and Iceland.", audio: "assets/audio/nl/travel/answers/trav4_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Reis je liever alleen, met vrienden, of met familie?",
                english: "Do you prefer traveling alone, with friends, or with family?",
                audio: "assets/audio/nl/travel/trav5_met_wie.mp3"
              },
              answers: [
                { dutch: "Met vrienden. We maken altijd plezier samen.", english: "With friends. We always have fun together.", audio: "assets/audio/nl/travel/answers/trav5_ans1.mp3" },
                { dutch: "Alleen soms. Dan ben ik helemaal vrij.", english: "Alone sometimes. Then I'm completely free.", audio: "assets/audio/nl/travel/answers/trav5_ans2.mp3" },
                { dutch: "Met mijn partner. We delen alles.", english: "With my partner. We share everything.", audio: "assets/audio/nl/travel/answers/trav5_ans3.mp3" }
              ]
            }
          ]
        },

        // ===================================================================
        // CONVERSATION GROUP 3: WORK & CAREER
        // ===================================================================
        {
          id: 'group-work',
          name: 'Conversation - Work & Career',
          isWelcome: false,
          exchanges: [
            {
              question: {
                dutch: "Wat voor werk doe je? Of studeer je nog?",
                english: "What kind of work do you do? Or are you still studying?",
                audio: "assets/audio/nl/work/work1_wat_werk.mp3"
              },
              answers: [
                { dutch: "Ik werk in IT. Ik ben softwareontwikkelaar.", english: "I work in IT. I'm a software developer.", audio: "assets/audio/nl/work/answers/work1_ans1.mp3" },
                { dutch: "Ik studeer nog. Bedrijfskunde aan de universiteit.", english: "I'm still studying. Business administration at university.", audio: "assets/audio/nl/work/answers/work1_ans2.mp3" },
                { dutch: "Ik ben leraar. Ik geef les op een middelbare school.", english: "I'm a teacher. I teach at a high school.", audio: "assets/audio/nl/work/answers/work1_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Vind je je werk leuk? Wat is het beste eraan?",
                english: "Do you like your work? What's the best thing about it?",
                audio: "assets/audio/nl/work/work2_vind_leuk.mp3"
              },
              answers: [
                { dutch: "Ja, heel erg! De collega's zijn fantastisch.", english: "Yes, very much! The colleagues are fantastic.", audio: "assets/audio/nl/work/answers/work2_ans1.mp3" },
                { dutch: "Het is uitdagend. Ik leer elke dag nieuwe dingen.", english: "It's challenging. I learn new things every day.", audio: "assets/audio/nl/work/answers/work2_ans2.mp3" },
                { dutch: "De vrijheid. Ik kan mijn eigen tijd indelen.", english: "The freedom. I can organize my own time.", audio: "assets/audio/nl/work/answers/work2_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Werk je op kantoor of thuis? Of een combinatie?",
                english: "Do you work at an office or at home? Or a combination?",
                audio: "assets/audio/nl/work/work3_waar.mp3"
              },
              answers: [
                { dutch: "Volledig thuis. Sinds corona is dat normaal.", english: "Fully at home. That's normal since corona.", audio: "assets/audio/nl/work/answers/work3_ans1.mp3" },
                { dutch: "Hybride. Drie dagen kantoor, twee dagen thuis.", english: "Hybrid. Three days office, two days home.", audio: "assets/audio/nl/work/answers/work3_ans2.mp3" },
                { dutch: "Altijd op kantoor. Ik hou van de sociale interactie.", english: "Always at the office. I like the social interaction.", audio: "assets/audio/nl/work/answers/work3_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Heb je ambities voor de toekomst? Een droombaan misschien?",
                english: "Do you have ambitions for the future? A dream job perhaps?",
                audio: "assets/audio/nl/work/work4_ambities.mp3"
              },
              answers: [
                { dutch: "Ja! Ik wil ooit mijn eigen bedrijf starten.", english: "Yes! I want to start my own business someday.", audio: "assets/audio/nl/work/answers/work4_ans1.mp3" },
                { dutch: "Ik wil doorgroeien naar een leidinggevende functie.", english: "I want to grow into a management position.", audio: "assets/audio/nl/work/answers/work4_ans2.mp3" },
                { dutch: "Niet echt. Ik ben tevreden waar ik nu ben.", english: "Not really. I'm satisfied where I am now.", audio: "assets/audio/nl/work/answers/work4_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Hoe is de werk-priv√©balans? Lukt het om tijd voor jezelf te maken?",
                english: "How is the work-life balance? Do you manage to make time for yourself?",
                audio: "assets/audio/nl/work/work5_balans.mp3"
              },
              answers: [
                { dutch: "Redelijk goed. Ik let er bewust op.", english: "Reasonably good. I consciously pay attention to it.", audio: "assets/audio/nl/work/answers/work5_ans1.mp3" },
                { dutch: "Moeilijk soms. Werk kan veel tijd kosten.", english: "Difficult sometimes. Work can take a lot of time.", audio: "assets/audio/nl/work/answers/work5_ans2.mp3" },
                { dutch: "Uitstekend! Ik maak altijd tijd voor hobby's.", english: "Excellent! I always make time for hobbies.", audio: "assets/audio/nl/work/answers/work5_ans3.mp3" }
              ]
            }
          ]
        },

        // ===================================================================
        // CONVERSATION GROUP 4: FOOD & DINING
        // ===================================================================
        {
          id: 'group-food',
          name: 'Conversation - Food & Dining',
          isWelcome: false,
          exchanges: [
            {
              question: {
                dutch: "Wat is je favoriete eten? Kook je het zelf?",
                english: "What's your favorite food? Do you cook it yourself?",
                audio: "assets/audio/nl/food/food1_favoriet.mp3"
              },
              answers: [
                { dutch: "Italiaans! Pasta maak ik vaak zelf.", english: "Italian! I often make pasta myself.", audio: "assets/audio/nl/food/answers/food1_ans1.mp3" },
                { dutch: "Aziatisch eten. Thais en Vietnamees vooral.", english: "Asian food. Thai and Vietnamese especially.", audio: "assets/audio/nl/food/answers/food1_ans2.mp3" },
                { dutch: "Nederlandse klassiekers. Stamppot en hutspot!", english: "Dutch classics. Stamppot and hutspot!", audio: "assets/audio/nl/food/answers/food1_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Ga je vaak uit eten? Wat is je favoriete restaurant?",
                english: "Do you eat out often? What's your favorite restaurant?",
                audio: "assets/audio/nl/food/food2_uit_eten.mp3"
              },
              answers: [
                { dutch: "Elke week wel. Er is een goed Italiaans restaurant hier.", english: "Every week. There's a good Italian restaurant here.", audio: "assets/audio/nl/food/answers/food2_ans1.mp3" },
                { dutch: "Soms. Voor speciale gelegenheden meestal.", english: "Sometimes. Mostly for special occasions.", audio: "assets/audio/nl/food/answers/food2_ans2.mp3" },
                { dutch: "Niet vaak. Ik kook liever zelf thuis.", english: "Not often. I prefer cooking at home myself.", audio: "assets/audio/nl/food/answers/food2_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Ben je vegetarisch of veganistisch? Of eet je van alles?",
                english: "Are you vegetarian or vegan? Or do you eat everything?",
                audio: "assets/audio/nl/food/food3_dieet.mp3"
              },
              answers: [
                { dutch: "Ik ben vegetarisch. Al vijf jaar nu.", english: "I'm vegetarian. For five years now.", audio: "assets/audio/nl/food/answers/food3_ans1.mp3" },
                { dutch: "Ik eet van alles. Niet te kieskeurig.", english: "I eat everything. Not too picky.", audio: "assets/audio/nl/food/answers/food3_ans2.mp3" },
                { dutch: "Vooral plantaardig, maar niet strikt veganistisch.", english: "Mainly plant-based, but not strictly vegan.", audio: "assets/audio/nl/food/answers/food3_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Wat is het beste gerecht dat je ooit hebt gegeten?",
                english: "What's the best dish you've ever eaten?",
                audio: "assets/audio/nl/food/food4_beste_gerecht.mp3"
              },
              answers: [
                { dutch: "Een perfecte risotto in Milaan. Onvergetelijk!", english: "A perfect risotto in Milan. Unforgettable!", audio: "assets/audio/nl/food/answers/food4_ans1.mp3" },
                { dutch: "Sushi in Japan. Zo vers en lekker.", english: "Sushi in Japan. So fresh and delicious.", audio: "assets/audio/nl/food/answers/food4_ans2.mp3" },
                { dutch: "Mijn oma's appeltaart. Niemand maakt het beter.", english: "My grandma's apple pie. Nobody makes it better.", audio: "assets/audio/nl/food/answers/food4_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Experimenteer je met nieuwe recepten? Hoe gaat dat?",
                english: "Do you experiment with new recipes? How does that go?",
                audio: "assets/audio/nl/food/food5_experimenteren.mp3"
              },
              answers: [
                { dutch: "Ja, vaak! Soms mislukt het, maar dat hoort erbij.", english: "Yes, often! Sometimes it fails, but that's part of it.", audio: "assets/audio/nl/food/answers/food5_ans1.mp3" },
                { dutch: "Soms. Ik volg meestal gewoon recepten online.", english: "Sometimes. I usually just follow recipes online.", audio: "assets/audio/nl/food/answers/food5_ans2.mp3" },
                { dutch: "Niet echt. Ik hou me aan bekende gerechten.", english: "Not really. I stick to familiar dishes.", audio: "assets/audio/nl/food/answers/food5_ans3.mp3" }
              ]
            }
          ]
        },

        // ===================================================================
        // CONVERSATION GROUP 5: DAILY LIFE & ROUTINES
        // ===================================================================
        {
          id: 'group-daily',
          name: 'Conversation - Daily Life',
          isWelcome: false,
          exchanges: [
            {
              question: {
                dutch: "Hoe ziet je dagelijkse routine eruit? Ben je een ochtendmens?",
                english: "What does your daily routine look like? Are you a morning person?",
                audio: "assets/audio/nl/daily/daily1_routine.mp3"
              },
              answers: [
                { dutch: "Ja! Ik sta vroeg op en sport meteen.", english: "Yes! I get up early and exercise right away.", audio: "assets/audio/nl/daily/answers/daily1_ans1.mp3" },
                { dutch: "Niet echt. Ik ben meer een avondmens.", english: "Not really. I'm more of an evening person.", audio: "assets/audio/nl/daily/answers/daily1_ans2.mp3" },
                { dutch: "Het hangt ervan af. Geen vaste routine echt.", english: "It depends. No fixed routine really.", audio: "assets/audio/nl/daily/answers/daily1_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Hoe ontspan je na een drukke dag?",
                english: "How do you relax after a busy day?",
                audio: "assets/audio/nl/daily/daily2_ontspannen.mp3"
              },
              answers: [
                { dutch: "Ik kijk een serie op Netflix. Heerlijk op de bank.", english: "I watch a series on Netflix. Lovely on the couch.", audio: "assets/audio/nl/daily/answers/daily2_ans1.mp3" },
                { dutch: "Wandelen helpt mij. Frisse lucht en bewegen.", english: "Walking helps me. Fresh air and movement.", audio: "assets/audio/nl/daily/answers/daily2_ans2.mp3" },
                { dutch: "Lezen. Een goed boek is perfecte ontspanning.", english: "Reading. A good book is perfect relaxation.", audio: "assets/audio/nl/daily/answers/daily2_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Doe je aan een sport of fitness?",
                english: "Do you do sports or fitness?",
                audio: "assets/audio/nl/daily/daily3_sport.mp3"
              },
              answers: [
                { dutch: "Ja, ik ga drie keer per week naar de sportschool.", english: "Yes, I go to the gym three times a week.", audio: "assets/audio/nl/daily/answers/daily3_ans1.mp3" },
                { dutch: "Ik hardloop regelmatig. Twee tot drie keer per week.", english: "I run regularly. Two to three times a week.", audio: "assets/audio/nl/daily/answers/daily3_ans2.mp3" },
                { dutch: "Niet echt. Ik probeer wel actief te blijven.", english: "Not really. I do try to stay active though.", audio: "assets/audio/nl/daily/answers/daily3_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Hoe belangrijk is slaap voor je? Hoeveel uur per nacht?",
                english: "How important is sleep for you? How many hours per night?",
                audio: "assets/audio/nl/daily/daily4_slaap.mp3"
              },
              answers: [
                { dutch: "Heel belangrijk! Minimaal acht uur nodig.", english: "Very important! Need at least eight hours.", audio: "assets/audio/nl/daily/answers/daily4_ans1.mp3" },
                { dutch: "Ongeveer zeven uur. Dat is genoeg voor mij.", english: "About seven hours. That's enough for me.", audio: "assets/audio/nl/daily/answers/daily4_ans2.mp3" },
                { dutch: "Ik slaap te weinig eigenlijk. Moet beter.", english: "I sleep too little actually. Should improve.", audio: "assets/audio/nl/daily/answers/daily4_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Wat is je favoriete moment van de dag en waarom?",
                english: "What's your favorite moment of the day and why?",
                audio: "assets/audio/nl/daily/daily5_favoriet_moment.mp3"
              },
              answers: [
                { dutch: "De ochtend. Alles is nog rustig en stil.", english: "The morning. Everything is still calm and quiet.", audio: "assets/audio/nl/daily/answers/daily5_ans1.mp3" },
                { dutch: "De avond. Tijd voor mezelf na het werk.", english: "The evening. Time for myself after work.", audio: "assets/audio/nl/daily/answers/daily5_ans2.mp3" },
                { dutch: "Lunchpauze. Even pauze van alles.", english: "Lunch break. A break from everything.", audio: "assets/audio/nl/daily/answers/daily5_ans3.mp3" }
              ]
            }
          ]
        },

        // ===================================================================
        // CONVERSATION GROUP 6: CULTURE & ENTERTAINMENT
        // ===================================================================
        {
          id: 'group-culture',
          name: 'Conversation - Culture & Entertainment',
          isWelcome: false,
          exchanges: [
            {
              question: {
                dutch: "Kijk je veel films of series? Wat is je favoriete genre?",
                english: "Do you watch many movies or series? What's your favorite genre?",
                audio: "assets/audio/nl/culture/cult1_films.mp3"
              },
              answers: [
                { dutch: "Ja, vooral thrillers en mysteries. Hou van spanning!", english: "Yes, especially thrillers and mysteries. Love suspense!" },
                { dutch: "Comedies! Ik hou van lachen en luchtige dingen.", english: "Comedies! I love laughing and light things." },
                { dutch: "Drama's en documentaires. Liefst iets met diepgang.", english: "Dramas and documentaries. Preferably something with depth.", audio: "assets/audio/nl/culture/answers/cult1_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Ga je wel eens naar het theater of musea?",
                english: "Do you ever go to the theater or museums?",
                audio: "assets/audio/nl/culture/cult2_theater.mp3"
              },
              answers: [
                { dutch: "Ja, regelmatig! Cultuur is belangrijk voor mij.", english: "Yes, regularly! Culture is important to me.", audio: "assets/audio/nl/culture/answers/cult2_ans1.mp3" },
                { dutch: "Soms. Als er iets interessants is.", english: "Sometimes. When there's something interesting.", audio: "assets/audio/nl/culture/answers/cult2_ans2.mp3" },
                { dutch: "Niet vaak. Maar ik vind het wel leuk.", english: "Not often. But I do enjoy it.", audio: "assets/audio/nl/culture/answers/cult2_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Welk boek of film heeft recent indruk op je gemaakt?",
                english: "Which book or movie recently made an impression on you?",
                audio: "assets/audio/nl/culture/cult3_indruk.mp3"
              },
              answers: [
                { dutch: "Een documentaire over klimaatverandering. Heel confronterend.", english: "A documentary about climate change. Very confronting.", audio: "assets/audio/nl/culture/answers/cult3_ans1.mp3" },
                { dutch: "De laatste thriller die ik las. Kon niet stoppen!", english: "The last thriller I read. Couldn't stop!", audio: "assets/audio/nl/culture/answers/cult3_ans2.mp3" },
                { dutch: "Een Nederlandse film over de oorlog. Emotioneel.", english: "A Dutch film about the war. Emotional.", audio: "assets/audio/nl/culture/answers/cult3_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Ben je bekend met Nederlandse cultuur? Wat vind je ervan?",
                english: "Are you familiar with Dutch culture? What do you think of it?",
                audio: "assets/audio/nl/culture/cult4_nederlandse_cultuur.mp3"
              },
              answers: [
                { dutch: "Een beetje. Ik vind het fascinerend en open.", english: "A bit. I find it fascinating and open.", audio: "assets/audio/nl/culture/answers/cult4_ans1.mp3" },
                { dutch: "Ja, redelijk. De directheid is interessant!", english: "Yes, reasonably. The directness is interesting!", audio: "assets/audio/nl/culture/answers/cult4_ans2.mp3" },
                { dutch: "Nog niet veel. Ik leer er steeds meer over.", english: "Not much yet. I'm learning more and more about it.", audio: "assets/audio/nl/culture/answers/cult4_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Welke Nederlandse traditie of feestdag vind je het leukst?",
                english: "Which Dutch tradition or holiday do you like best?",
                audio: "assets/audio/nl/culture/cult5_traditie.mp3"
              },
              answers: [
                { dutch: "Sinterklaas! Zo anders dan andere culturen.", english: "Sinterklaas! So different from other cultures.", audio: "assets/audio/nl/culture/answers/cult5_ans1.mp3" },
                { dutch: "Koningsdag. De hele stad is oranje en feest!", english: "King's Day. The whole city is orange and celebrating!", audio: "assets/audio/nl/culture/answers/cult5_ans2.mp3" },
                { dutch: "Oudjaarsavond met oliebollen. Heerlijk!", english: "New Year's Eve with oliebollen. Delicious!", audio: "assets/audio/nl/culture/answers/cult5_ans3.mp3" }
              ]
            }
          ]
        },

        // ===================================================================
        // CONVERSATION GROUP 7: FUTURE PLANS & DREAMS
        // ===================================================================
        {
          id: 'group-future',
          name: 'Conversation - Future & Dreams',
          isWelcome: false,
          exchanges: [
            {
              question: {
                dutch: "Waar zie je jezelf over vijf jaar?",
                english: "Where do you see yourself in five years?",
                audio: "assets/audio/nl/future/fut1_vijf_jaar.mp3"
              },
              answers: [
                { dutch: "Hopelijk in mijn eigen huis met een gezin.", english: "Hopefully in my own house with a family.", audio: "assets/audio/nl/future/answers/fut1_ans1.mp3" },
                { dutch: "Verder in mijn carri√®re. Misschien management.", english: "Further in my career. Maybe management.", audio: "assets/audio/nl/future/answers/fut1_ans2.mp3" },
                { dutch: "Ik weet het nog niet precies. We zien wel!", english: "I don't know exactly yet. We'll see!", audio: "assets/audio/nl/future/answers/fut1_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Heb je een droom die je graag wilt waarmaken?",
                english: "Do you have a dream you'd like to fulfill?",
                audio: "assets/audio/nl/future/fut2_droom.mp3"
              },
              answers: [
                { dutch: "Ja! Een wereldreis maken. Alle continenten zien.", english: "Yes! Take a world trip. See all continents.", audio: "assets/audio/nl/future/answers/fut2_ans1.mp3" },
                { dutch: "Mijn eigen bedrijf starten. Dat is mijn grote doel.", english: "Start my own business. That's my big goal.", audio: "assets/audio/nl/future/answers/fut2_ans2.mp3" },
                { dutch: "Een boek schrijven. Ik heb al idee√´n!", english: "Write a book. I already have ideas!", audio: "assets/audio/nl/future/answers/fut2_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Wat wil je nog leren of kunnen in je leven?",
                english: "What do you still want to learn or be able to do in your life?",
                audio: "assets/audio/nl/future/fut3_nog_leren.mp3"
              },
              answers: [
                { dutch: "Een muziekinstrument bespelen. Piano of gitaar.", english: "Play a musical instrument. Piano or guitar.", audio: "assets/audio/nl/future/answers/fut3_ans1.mp3" },
                { dutch: "Nog meer talen leren. Frans of Spaans misschien.", english: "Learn more languages. French or Spanish maybe.", audio: "assets/audio/nl/future/answers/fut3_ans2.mp3" },
                { dutch: "Duiken. De onderwaterwereld verkennen.", english: "Scuba diving. Explore the underwater world.", audio: "assets/audio/nl/future/answers/fut3_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Blijf je in Nederland wonen of wil je emigreren?",
                english: "Will you stay living in the Netherlands or do you want to emigrate?",
                audio: "assets/audio/nl/future/fut4_blijven.mp3"
              },
              answers: [
                { dutch: "Ik blijf hier. Nederland is mijn thuis nu.", english: "I'll stay here. The Netherlands is my home now.", audio: "assets/audio/nl/future/answers/fut4_ans1.mp3" },
                { dutch: "Misschien tijdelijk ergens anders. Voor ervaring.", english: "Maybe temporarily somewhere else. For experience.", audio: "assets/audio/nl/future/answers/fut4_ans2.mp3" },
                { dutch: "Ik weet het nog niet. Ik sta open voor alles.", english: "I don't know yet. I'm open to everything.", audio: "assets/audio/nl/future/answers/fut4_ans3.mp3" }
              ]
            },
            {
              question: {
                dutch: "Wat is je grootste hoop voor de toekomst?",
                english: "What is your biggest hope for the future?",
                audio: "assets/audio/nl/future/fut5_grootste_hoop.mp3"
              },
              answers: [
                { dutch: "Gezondheid en geluk voor mijn familie en mezelf.", english: "Health and happiness for my family and myself.", audio: "assets/audio/nl/future/answers/fut5_ans1.mp3" },
                { dutch: "Succesvol zijn in wat ik doe. Voldoening vinden.", english: "Be successful in what I do. Find fulfillment.", audio: "assets/audio/nl/future/answers/fut5_ans2.mp3" },
                { dutch: "De wereld een beetje beter maken. Bijdragen.", english: "Make the world a little better. Contribute.", audio: "assets/audio/nl/future/answers/fut5_ans3.mp3" }
              ]
            }
          ]
        },

        // Keep old conversation for backward compatibility but mark it as unused
        {
          id: 'meetup-intro',
          name: 'Language Meetup - Getting Acquainted (LEGACY - DO NOT USE)',
          isWelcome: false,
          isLegacy: true,
          exchanges: [
            // Exchange 0: Opening greeting
            {
              question: {
                dutch: "Hallo! Leuk je te ontmoeten. Hoe gaat het met je?",
                english: "Hello! Nice to meet you. How are you?",
                audio: "assets/audio/nl/meetup/ex0_hoe_gaat_het.mp3"
              },
              answers: [
                { dutch: "Goed, dank je! Ik ben een beetje zenuwachtig.", english: "Good, thank you! I'm a bit nervous.", branch: 1, audio: "assets/audio/nl/meetup/answers/ans_ex0_goed.mp3" },
                { dutch: "Heel goed! Ik vind het spannend om Nederlands te oefenen.", english: "Very good! I'm excited to practice Dutch.", branch: 2, audio: "assets/audio/nl/meetup/answers/ans_ex0_heel_goed.mp3" },
                { dutch: "Prima! Ik ben hier voor het eerst.", english: "Great! This is my first time here.", branch: 3, audio: "assets/audio/nl/meetup/answers/ans_ex0_prima.mp3" }
              ]
            },
            
            // Branch 1: User is nervous
            {
              question: {
                dutch: "Maak je geen zorgen! Iedereen maakt fouten. Vertel eens, waar kom je vandaan?",
                english: "Don't worry! Everyone makes mistakes. Tell me, where are you from?",
                audio: "assets/audio/nl/meetup/ex1_waar_kom_je_vandaan.mp3"
              },
              answers: [
                { dutch: "Ik kom uit de Verenigde Staten, uit New York.", english: "I'm from the United States, from New York.", branch: 4 },
                { dutch: "Ik ben uit Australi√´, uit Sydney.", english: "I'm from Australia, from Sydney.", branch: 5 },
                { dutch: "Ik kom uit het Verenigd Koninkrijk, uit Londen.", english: "I'm from the United Kingdom, from London.", branch: 6 }
              ]
            },
            
            // Branch 2: User is excited
            {
              question: {
                dutch: "Wat leuk! Wat is je favoriete Nederlandse woord tot nu toe?",
                english: "How nice! What's your favorite Dutch word so far?",
                audio: "assets/audio/nl/meetup/ex2_favoriete_woord.mp3"
              },
              answers: [
                { dutch: "Ik vind 'gezellig' mooi. Het heeft geen echte vertaling.", english: "I like 'gezellig'. It has no real translation.", branch: 7 },
                { dutch: "'Alstublieft' klinkt grappig als ik het zeg!", english: "'Alstublieft' sounds funny when I say it!", branch: 8 },
                { dutch: "Ik weet het niet zeker. Ik leer nog steeds.", english: "I'm not sure. I'm still learning.", branch: 9 }
              ]
            },
            
            // Branch 3: First time at meetup
            {
              question: {
                dutch: "Welkom! Hoe heb je over deze meetup gehoord?",
                english: "Welcome! How did you hear about this meetup?",
                audio: "assets/audio/nl/meetup/ex3_hoe_gehoord.mp3"
              },
              answers: [
                { dutch: "Mijn vriend vertelde me erover. Hij komt hier vaak.", english: "My friend told me about it. He comes here often.", branch: 10 },
                { dutch: "Ik zag het op Facebook in een taalgroep.", english: "I saw it on Facebook in a language group.", branch: 11 },
                { dutch: "Ik zoekt online naar Nederlandse oefenmogelijkheden.", english: "I was searching online for Dutch practice opportunities.", branch: 12 }
              ]
            },
            
            // Branch 4: From New York
            {
              question: {
                dutch: "New York! Wat bracht je naar Nederland, of oefen je vanaf Amerika?",
                english: "New York! What brought you to the Netherlands, or are you practicing from America?",
                audio: "assets/audio/nl/meetup/ex4_naar_nederland.mp3"
              },
              answers: [
                { dutch: "Ik woon nu in Amsterdam. Ik werk hier als softwareontwikkelaar.", english: "I live in Amsterdam now. I work here as a software developer.", branch: 13 },
                { dutch: "Ik plan volgend jaar te verhuizen voor studie.", english: "I'm planning to move next year for studies.", branch: 14 },
                { dutch: "Ik oefen thuis. Mijn partner is Nederlands.", english: "I'm practicing from home. My partner is Dutch.", branch: 15 }
              ]
            },
            
            // Branch 5: From Sydney
            {
              question: {
                dutch: "Australi√´! Dat is een lange reis. Wat vind je het moeilijkste aan het Nederlands?",
                english: "Australia! That's a long journey. What do you find most difficult about Dutch?",
                audio: "assets/audio/nl/meetup/ex5_moeilijkste.mp3"
              },
              answers: [
                { dutch: "De uitspraak! Vooral de 'g' en 'sch' klanken.", english: "The pronunciation! Especially the 'g' and 'sch' sounds.", branch: 16 },
                { dutch: "De woordvolgorde in zinnen verwaart me soms.", english: "The word order in sentences confuses me sometimes.", branch: 17 },
                { dutch: "De lidwoorden 'de' en 'het'. Hoe weet je welke te gebruiken?", english: "The articles 'de' and 'het'. How do you know which to use?", branch: 18 }
              ]
            },
            
            // Branch 6: From London
            {
              question: {
                dutch: "Ah, het Verenigd Koninkrijk! Spreek je ook andere talen?",
                english: "Ah, the United Kingdom! Do you speak other languages too?",
                audio: "assets/audio/nl/meetup/ex6_andere_talen.mp3"
              },
              answers: [
                { dutch: "Ja, ik spreek vloeiend Frans. Ik studeerde het op school.", english: "Yes, I speak French fluently. I studied it at school.", branch: 19 },
                { dutch: "Een beetje Spaans, maar Nederlands is mijn derde poging!", english: "A bit of Spanish, but Dutch is my third attempt!", branch: 20 },
                { dutch: "Nee, alleen Engels tot nu toe. Nederlands is mijn eerste!", english: "No, just English so far. Dutch is my first!", branch: 21 }
              ]
            },
            
            // Branch 7: Likes "gezellig"
            {
              question: {
                dutch: "Precies! 'Gezellig' is typisch Nederlands. Hoe lang studeer je al?",
                english: "Exactly! 'Gezellig' is typically Dutch. How long have you been studying?",
                audio: "assets/audio/nl/meetup/ex7_hoe_lang.mp3"
              },
              answers: [
                { dutch: "Ongeveer zes maanden intensief. Ik gebruik Duolingo dagelijks.", english: "About six months intensively. I use Duolingo daily.", branch: 22 },
                { dutch: "Al twee jaar, maar pas recent met spreken begonnen.", english: "Two years already, but only recently started speaking.", branch: 23 },
                { dutch: "Drie maanden. Ik neem ook priv√©lessen.", english: "Three months. I'm also taking private lessons.", branch: 24 }
              ]
            },
            
            // Branch 8: Likes "alstublieft"
            {
              question: {
                dutch: "Haha, ja! Het is een mondvol. Gebruik je meestal 'alstublieft' of 'alsjeblieft'?",
                english: "Haha, yes! It's a mouthful. Do you usually use 'alstublieft' or 'alsjeblieft'?",
                audio: "assets/audio/nl/meetup/ex8_welke_versie.mp3"
              },
              answers: [
                { dutch: "Ik gebruik 'alsjeblieft' met vrienden, informeel.", english: "I use 'alsjeblieft' with friends, informally.", branch: 25 },
                { dutch: "Meestal 'alstublieft'. Ik wil beleefd zijn.", english: "Mostly 'alstublieft'. I want to be polite.", branch: 26 },
                { dutch: "Ik weet het verschil eigenlijk niet goed!", english: "I don't actually know the difference well!", branch: 27 }
              ]
            },
            
            // Branch 9: Not sure about favorite word
            {
              question: {
                dutch: "Dat is ok√©! Welk onderwerp vind je het leukst om over te praten?",
                english: "That's okay! What topic do you enjoy talking about most?",
                audio: "assets/audio/nl/meetup/ex9_onderwerp.mp3"
              },
              answers: [
                { dutch: "Ik praat graag over reizen en cultuur.", english: "I like to talk about travel and culture.", branch: 28 },
                { dutch: "Technologie en innovatie interesseren me het meest.", english: "Technology and innovation interest me most.", branch: 29 },
                { dutch: "Eten! Ik wil graag over Nederlandse gerechten leren.", english: "Food! I want to learn about Dutch dishes.", branch: 30 }
              ]
            },
            
            // Branch 10: Friend told about meetup
            {
              question: {
                dutch: "Wat aardig van je vriend! Is hij of zij ook hier vanavond?",
                english: "How nice of your friend! Is he or she also here tonight?",
                audio: "assets/audio/nl/meetup/ex10_vriend_hier.mp3"
              },
              answers: [
                { dutch: "Ja, hij komt later. Hij werkt tot acht uur.", english: "Yes, he's coming later. He works until eight o'clock.", branch: 31 },
                { dutch: "Nee, zij kon vanavond niet komen. Ze studeert voor examens.", english: "No, she couldn't come tonight. She's studying for exams.", branch: 32 },
                { dutch: "Eigenlijk weet ik het niet zeker. We spraken snel.", english: "Actually, I'm not sure. We spoke quickly.", branch: 33 }
              ]
            },
            
            // Branch 11: Found on Facebook
            {
              question: {
                dutch: "Social media is perfect voor taalgroepen! Volg je Nederlandse accounts?",
                english: "Social media is perfect for language groups! Do you follow Dutch accounts?",
                audio: "assets/audio/nl/meetup/ex11_nederlandse_accounts.mp3"
              },
              answers: [
                { dutch: "Ja! Ik volg Nederlandse nieuwskanalen en podcasts.", english: "Yes! I follow Dutch news channels and podcasts.", branch: 34 },
                { dutch: "Een paar, vooral voor leren en oefening.", english: "A few, mainly for learning and practice.", branch: 35 },
                { dutch: "Nog niet. Heb je aanbevelingen?", english: "Not yet. Do you have recommendations?", branch: 36 }
              ]
            },
            
            // Branch 12: Searched online
            {
              question: {
                dutch: "Goed initiatief! Wat is je leerdoel voor dit jaar?",
                english: "Good initiative! What's your learning goal for this year?",
                audio: "assets/audio/nl/meetup/ex12_leerdoel.mp3"
              },
              answers: [
                { dutch: "Ik wil conversaties kunnen voeren zonder Engels.", english: "I want to be able to have conversations without English.", branch: 37 },
                { dutch: "Het NT2 examen halen voor werk of studie.", english: "Pass the NT2 exam for work or study.", branch: 38 },
                { dutch: "Gewoon comfortabel voelen bij dagelijkse situaties.", english: "Just feel comfortable in daily situations.", branch: 39 }
              ]
            },
            
            // Continuation branches (13-39) - These create deeper conversations
            
            // Branch 13: Works in Amsterdam
            {
              question: {
                dutch: "Geweldig! Spreekt iedereen Engels op je werk, of moet je Nederlands gebruiken?",
                english: "Great! Does everyone speak English at your work, or do you need to use Dutch?",
                audio: "assets/audio/nl/meetup/ex13_werk_taal.mp3"
              },
              answers: [
                { dutch: "Voornamelijk Engels, maar vergaderingen zijn soms in het Nederlands.", english: "Mainly English, but meetings are sometimes in Dutch.", branch: 40 },
                { dutch: "Gemengd. Ik probeer meer Nederlands te spreken elke week.", english: "Mixed. I try to speak more Dutch each week.", branch: 40 },
                { dutch: "Meestal Nederlands nu. Het verbetert snel!", english: "Mostly Dutch now. It's improving fast!", branch: 40 }
              ]
            },
            
            // Branch 14: Planning to move for studies
            {
              question: {
                dutch: "Spannend! Welke universiteit? Wat ga je studeren?",
                english: "Exciting! Which university? What will you study?",
                audio: "assets/audio/nl/meetup/ex14_studie.mp3"
              },
              answers: [
                { dutch: "De Universiteit van Amsterdam, internationale betrekkingen.", english: "University of Amsterdam, international relations.", branch: 40 },
                { dutch: "TU Delft voor engineering. Het programma is wereldberoemd.", english: "TU Delft for engineering. The program is world-renowned.", branch: 40 },
                { dutch: "Erasmus Universiteit Rotterdam, bedrijfskunde.", english: "Erasmus University Rotterdam, business administration.", branch: 40 }
              ]
            },
            
            // Branch 15: Partner is Dutch
            {
              question: {
                dutch: "Wat romantisch! Praat je meestal Nederlands of Engels met je partner?",
                english: "How romantic! Do you usually speak Dutch or English with your partner?",
                audio: "assets/audio/nl/meetup/ex15_partner_taal.mp3"
              },
              answers: [
                { dutch: "We wisselen af. Hij/zij is geduldig met mijn fouten.", english: "We alternate. He/she is patient with my mistakes.", branch: 40 },
                { dutch: "Vooral Engels, maar ik wil meer Nederlands oefenen.", english: "Mainly English, but I want to practice more Dutch.", branch: 40 },
                { dutch: "Steeds meer Nederlands. Het helpt echt!", english: "More and more Dutch. It really helps!", branch: 40 }
              ]
            },
            
            // Branch 16: Pronunciation is difficult
            {
              question: {
                dutch: "Dat hoor ik vaak! Oefen je met tongbrekers zoals 'Scheveningen'?",
                english: "I hear that often! Do you practice with tongue twisters like 'Scheveningen'?",
                audio: "assets/audio/nl/meetup/ex16_tongbrekers.mp3"
              },
              answers: [
                { dutch: "Ja! Ik oefen dagelijks, maar het blijft lastig.", english: "Yes! I practice daily, but it remains difficult.", branch: 40 },
                { dutch: "Soms. YouTube video's helpen me veel.", english: "Sometimes. YouTube videos help me a lot.", branch: 40 },
                { dutch: "Nog niet geprobeerd. Dat klinkt moeilijk!", english: "Haven't tried yet. That sounds hard!", branch: 40 }
              ]
            },
            
            // Branch 17: Word order confuses
            {
              question: {
                dutch: "Het werkwoord aan het einde kan verwarrend zijn! Lees je Nederlandse boeken?",
                english: "The verb at the end can be confusing! Do you read Dutch books?",
                audio: "assets/audio/nl/meetup/ex17_boeken.mp3"
              },
              answers: [
                { dutch: "Ja, kinderboeken momenteel. Ze zijn makkelijker te begrijpen.", english: "Yes, children's books currently. They're easier to understand.", branch: 40 },
                { dutch: "Ik probeer het nieuws online te lezen dagelijks.", english: "I try to read the news online daily.", branch: 40 },
                { dutch: "Nog niet. Ik begin met korte artikelen eerst.", english: "Not yet. I'm starting with short articles first.", branch: 40 }
              ]
            },
            
            // Branch 18: Articles are difficult
            {
              question: {
                dutch: "Ah, de versus het! Er is geen perfecte regel. Leer je ze uit het hoofd?",
                english: "Ah, de versus het! There's no perfect rule. Do you learn them by heart?",
                audio: "assets/audio/nl/meetup/ex18_leren.mp3"
              },
              answers: [
                { dutch: "Ja, ik maak flashcards voor alle nieuwe woorden.", english: "Yes, I make flashcards for all new words.", branch: 40 },
                { dutch: "Ik probeer ze in context te onthouden uit zinnen.", english: "I try to remember them in context from sentences.", branch: 40 },
                { dutch: "Ik raad meestal. Ik heb het juist de helft van de tijd!", english: "I usually guess. I get it right half the time!", branch: 40 }
              ]
            },
            
            // Branch 19: Speaks French fluently
            {
              question: {
                dutch: "Fantastisch! Helpt Frans je met Nederlands leren, of juist niet?",
                english: "Fantastic! Does French help you with learning Dutch, or not really?",
                audio: "assets/audio/nl/meetup/ex19_frans_helpt.mp3"
              },
              answers: [
                { dutch: "Soms. Sommige woorden lijken op elkaar.", english: "Sometimes. Some words are similar.", branch: 40 },
                { dutch: "Niet echt. De grammatica is heel anders.", english: "Not really. The grammar is very different.", branch: 40 },
                { dutch: "Het helpt met leren algemeen. Ik ken de methode.", english: "It helps with learning in general. I know the method.", branch: 40 }
              ]
            },
            
            // Branch 20: Third language attempt
            {
              question: {
                dutch: "Derde keer is scheepsrecht! Waarom stopte je met Spaans?",
                english: "Third time's the charm! Why did you stop with Spanish?",
                audio: "assets/audio/nl/meetup/ex20_waarom_gestopt.mp3"
              },
              answers: [
                { dutch: "Gebrek aan tijd. Werk werd te druk toen.", english: "Lack of time. Work got too busy then.", branch: 40 },
                { dutch: "Ik had geen mensen om mee te oefenen.", english: "I had no people to practice with.", branch: 40 },
                { dutch: "Nederlands is relevanter voor mijn situatie nu.", english: "Dutch is more relevant to my situation now.", branch: 40 }
              ]
            },
            
            // Branch 21: Dutch is first language
            {
              question: {
                dutch: "Wat moedig! Waarom koos je Nederlands als je eerste vreemde taal?",
                english: "How brave! Why did you choose Dutch as your first foreign language?",
                audio: "assets/audio/nl/meetup/ex21_waarom_nederlands.mp3"
              },
              answers: [
                { dutch: "Ik hou van de cultuur en de kunst.", english: "I love the culture and the art.", branch: 40 },
                { dutch: "Ik plan in Amsterdam te wonen binnenkort.", english: "I plan to live in Amsterdam soon.", branch: 40 },
                { dutch: "Het leek uitdagend en anders!", english: "It seemed challenging and different!", branch: 40 }
              ]
            },
            
            // Branch 22: Six months with Duolingo
            {
              question: {
                dutch: "Goed bezig! Wat is je langste streak op Duolingo?",
                english: "Well done! What's your longest streak on Duolingo?",
                audio: "assets/audio/nl/meetup/ex22_streak.mp3"
              },
              answers: [
                { dutch: "123 dagen! Ik ben er trots op.", english: "123 days! I'm proud of it.", branch: 40 },
                { dutch: "Ongeveer 50. Ik verloor het eens op vakantie.", english: "About 50. I lost it once on vacation.", branch: 40 },
                { dutch: "Ik tel niet meer. Ik doe het gewoon dagelijks.", english: "I don't count anymore. I just do it daily.", branch: 40 }
              ]
            },
            
            // Branch 23: Two years, recently started speaking
            {
              question: {
                dutch: "Twee jaar! Vind je spreken moeilijker dan lezen en schrijven?",
                english: "Two years! Do you find speaking harder than reading and writing?",
                audio: "assets/audio/nl/meetup/ex23_spreken_moeilijker.mp3"
              },
              answers: [
                { dutch: "Ja, veel moeilijker. Ik moet snel denken.", english: "Yes, much harder. I have to think quickly.", branch: 40 },
                { dutch: "Het went langzaam. Praktijk maakt perfect.", english: "It's getting easier slowly. Practice makes perfect.", branch: 40 },
                { dutch: "Verstaan is het moeilijkst voor mij eigenlijk.", english: "Understanding is actually the hardest for me.", branch: 40 }
              ]
            },
            
            // Branch 24: Three months with private lessons
            {
              question: {
                dutch: "Priv√©lessen zijn effectief! Hoe vaak heb je les per week?",
                english: "Private lessons are effective! How often do you have lessons per week?",
                audio: "assets/audio/nl/meetup/ex24_hoe_vaak_les.mp3"
              },
              answers: [
                { dutch: "Twee keer per week, telkens een uur.", english: "Twice a week, one hour each time.", branch: 40 },
                { dutch: "E√©n keer, maar wel twee uur intensief.", english: "Once, but two hours intensively.", branch: 40 },
                { dutch: "Het varieert. Mijn leraar is flexibel.", english: "It varies. My teacher is flexible.", branch: 40 }
              ]
            },
            
            // Branches 25-39 continue similarly...
            // For brevity, I'll add the remaining branches to reach the final question
            
            { question: { dutch: "Dat is slim! Formeel en informeel zijn belangrijk in het Nederlands.", english: "That's smart! Formal and informal are important in Dutch.", audio: "assets/audio/nl/meetup/ex25_formeel.mp3" }, answers: [{ dutch: "Ja, precies! Het is als 'you' versus 'y'all'.", english: "Yes, exactly! It's like 'you' versus 'y'all'.", branch: 40 }, { dutch: "Wanneer gebruik je 'u' in plaats van 'je'?", english: "When do you use 'u' instead of 'je'?", branch: 40 }, { dutch: "Het is verwarrend, maar ik leer het.", english: "It's confusing, but I'm learning it.", branch: 40 }] },
            { question: { dutch: "Goed! Beleefdheid wordt gewaardeerd in Nederlandse cultuur.", english: "Good! Politeness is appreciated in Dutch culture.", audio: "assets/audio/nl/meetup/ex26_beleefdheid.mp3" }, answers: [{ dutch: "Dat is goed om te weten. Dank je!", english: "That's good to know. Thank you!", branch: 40 }, { dutch: "Zijn Nederlanders over het algemeen formeel?", english: "Are Dutch people generally formal?", branch: 40 }, { dutch: "Ik wil geen onbeleefd overkomen.", english: "I don't want to come across as rude.", branch: 40 }] },
            { question: { dutch: "'Alsjeblieft' is informeel, 'alstublieft' is formeel. Zoals 'jij' en 'u'!", english: "'Alsjeblieft' is informal, 'alstublieft' is formal. Like 'jij' and 'u'!", audio: "assets/audio/nl/meetup/ex27_uitleg.mp3" }, answers: [{ dutch: "Ah! Dat maakt nu veel meer zin.", english: "Ah! That makes much more sense now.", branch: 40 }, { dutch: "Dus met familie gebruik ik 'alsjeblieft'?", english: "So with family I use 'alsjeblieft'?", branch: 40 }, { dutch: "Bedankt voor de uitleg! Heel nuttig.", english: "Thanks for the explanation! Very useful.", branch: 40 }] },
            { question: { dutch: "Reizen is een geweldig onderwerp! Ben je al in Nederland geweest?", english: "Travel is a great topic! Have you been to the Netherlands?", audio: "assets/audio/nl/meetup/ex28_nederland_bezocht.mp3" }, answers: [{ dutch: "Ja, vorig jaar voor twee weken. Het was prachtig!", english: "Yes, last year for two weeks. It was beautiful!", branch: 40 }, { dutch: "Nog niet, maar ik plan volgend voorjaar te gaan.", english: "Not yet, but I'm planning to go next spring.", branch: 40 }, { dutch: "Alleen Amsterdam. Ik wil meer steden zien.", english: "Only Amsterdam. I want to see more cities.", branch: 40 }] },
            { question: { dutch: "Tech is populair hier! Ken je Nederlandse tech bedrijven zoals Booking.com?", english: "Tech is popular here! Do you know Dutch tech companies like Booking.com?", audio: "assets/audio/nl/meetup/ex29_tech_bedrijven.mp3" }, answers: [{ dutch: "Ja! En ook Adyen en Mollie voor betalingen.", english: "Yes! And also Adyen and Mollie for payments.", branch: 40 }, { dutch: "Een paar. Nederland is innovatief in tech.", english: "A few. The Netherlands is innovative in tech.", branch: 40 }, { dutch: "Ik wil meer leren over de tech scene hier.", english: "I want to learn more about the tech scene here.", branch: 40 }] },
            { question: { dutch: "Lekker! Ken je stroopwafels? En bitterballen?", english: "Yummy! Do you know stroopwafels? And bitterballen?", audio: "assets/audio/nl/meetup/ex30_eten.mp3" }, answers: [{ dutch: "Ja! Stroopwafels zijn verslavend lekker!", english: "Yes! Stroopwafels are addictively delicious!", branch: 40 }, { dutch: "Bitterballen heb ik geprobeerd. Zo goed met mosterd!", english: "I've tried bitterballen. So good with mustard!", branch: 40 }, { dutch: "Nog niet! Waar kan ik ze proberen?", english: "Not yet! Where can I try them?", branch: 40 }] },
            
            // Branches 31-39 (friend/meetup related)
            { question: { dutch: "Gezellig! Dan kunnen jullie straks samen oefenen.", english: "Nice! Then you can practice together later.", audio: "assets/audio/nl/meetup/ex31_samen.mp3" }, answers: [{ dutch: "Ja, hij spreekt al goed Nederlands.", english: "Yes, he already speaks Dutch well.", branch: 40 }, { dutch: "We helpen elkaar met moeilijke zinnen.", english: "We help each other with difficult sentences.", branch: 40 }, { dutch: "Ik hoop dat hij niet te laat komt!", english: "I hope he doesn't come too late!", branch: 40 }] },
            { question: { dutch: "Veel succes met haar examens! Studeert zij ook Nederlands?", english: "Good luck with her exams! Is she also studying Dutch?", audio: "assets/audio/nl/meetup/ex32_studie.mp3" }, answers: [{ dutch: "Nee, zij studeert medicijnen. Heel zwaar.", english: "No, she studies medicine. Very tough.", branch: 40 }, { dutch: "Ja! We oefenen soms samen.", english: "Yes! We practice together sometimes.", branch: 40 }, { dutch: "Ze spreekt al vloeiend. Ze is Nederlandse.", english: "She already speaks fluently. She's Dutch.", branch: 40 }] },
            { question: { dutch: "Geen probleem! Het belangrijkste is dat jij hier bent.", english: "No problem! The important thing is that you're here.", audio: "assets/audio/nl/meetup/ex33_jij_hier.mp3" }, answers: [{ dutch: "Ja, ik wilde niet meer uitstellen.", english: "Yes, I didn't want to postpone anymore.", branch: 40 }, { dutch: "Ik ben zenuwachtig maar ook opgewonden!", english: "I'm nervous but also excited!", branch: 40 }, { dutch: "Beter alleen beginnen dan nooit!", english: "Better to start alone than never!", branch: 40 }] },
            { question: { dutch: "Slim! Onderdompeling helpt enorm met leren.", english: "Smart! Immersion helps tremendously with learning.", audio: "assets/audio/nl/meetup/ex34_onderdompeling.mp3" }, answers: [{ dutch: "Absoluut! Ik luister ook naar NOS Journaal.", english: "Absolutely! I also listen to NOS Journaal.", branch: 40 }, { dutch: "En Nederlandse Netflix series met ondertiteling.", english: "And Dutch Netflix series with subtitles.", branch: 40 }, { dutch: "Elke dag een beetje helpt echt.", english: "A little bit every day really helps.", branch: 40 }] },
            { question: { dutch: "Natuurlijk! Probeer 'Easy Dutch' op YouTube. Erg nuttig!", english: "Of course! Try 'Easy Dutch' on YouTube. Very useful!", audio: "assets/audio/nl/meetup/ex35_aanbeveling.mp3" }, answers: [{ dutch: "Bedankt! Ik ga dat vanavond bekijken.", english: "Thanks! I'll check that out tonight.", branch: 40 }, { dutch: "Zijn er ook goede podcasts?", english: "Are there also good podcasts?", branch: 40 }, { dutch: "Perfect! Ik maak een lijst.", english: "Perfect! I'll make a list.", branch: 40 }] },
            { question: { dutch: "Ja! Volg ook @learndutch en @dutchgrammar op Instagram.", english: "Yes! Also follow @learndutch and @dutchgrammar on Instagram.", audio: "assets/audio/nl/meetup/ex36_instagram.mp3" }, answers: [{ dutch: "Geweldig, dank je wel voor de tips!", english: "Great, thank you for the tips!", branch: 40 }, { dutch: "Ik ga ze nu meteen volgen.", english: "I'm going to follow them right now.", branch: 40 }, { dutch: "Social media leren werkt echt goed.", english: "Social media learning really works well.", branch: 40 }] },
            { question: { dutch: "Dat is een uitstekend doel! Hoeveel uur per week studeer je?", english: "That's an excellent goal! How many hours per week do you study?", audio: "assets/audio/nl/meetup/ex37_uren.mp3" }, answers: [{ dutch: "Ongeveer 10 uur, inclusief deze meetups.", english: "About 10 hours, including these meetups.", branch: 40 }, { dutch: "Zoveel als mogelijk. Minstens 5 uur.", english: "As much as possible. At least 5 hours.", branch: 40 }, { dutch: "Het varieert, maar ik probeer consistent te zijn.", english: "It varies, but I try to be consistent.", branch: 40 }] },
            { question: { dutch: "Het NT2 examen! Dat is serieus. Welk niveau ga je proberen?", english: "The NT2 exam! That's serious. Which level are you going to attempt?", audio: "assets/audio/nl/meetup/ex38_niveau.mp3" }, answers: [{ dutch: "NT2 Programma I. Het basisniveau voor werk.", english: "NT2 Program I. The basic level for work.", branch: 40 }, { dutch: "NT2 Programma II voor universitaire studie.", english: "NT2 Program II for university study.", branch: 40 }, { dutch: "Ik weet het nog niet zeker. Eerst oefenen!", english: "I'm not sure yet. First practice!", branch: 40 }] },
            { question: { dutch: "Dat is heel praktisch! Dagelijkse conversaties zijn het belangrijkst.", english: "That's very practical! Daily conversations are most important.", audio: "assets/audio/nl/meetup/ex39_praktisch.mp3" }, answers: [{ dutch: "Precies. Boodschappen doen, bestellen in restaurants...", english: "Exactly. Grocery shopping, ordering in restaurants...", branch: 40 }, { dutch: "En praten met buren en collega's.", english: "And talking with neighbors and colleagues.", branch: 40 }, { dutch: "Klein stapjes, maar vooruitgang!", english: "Small steps, but progress!", branch: 40 }] },
            
            // Branch 40: Final closing question (everyone converges here)
            {
              question: {
                dutch: "Wat geweldig om je verhaal te horen! Zullen we volgende week weer afspreken om verder te oefenen?",
                english: "How wonderful to hear your story! Shall we meet again next week to practice more?",
                audio: "assets/audio/nl/meetup/ex40_volgende_week.mp3"
              },
              answers: [
                { dutch: "Ja, graag! Zelfde tijd, zelfde plaats?", english: "Yes, please! Same time, same place?" },
                { dutch: "Absoluut! Ik kijk er naar uit.", english: "Absolutely! I'm looking forward to it." },
                { dutch: "Heel graag! Dit was echt nuttig.", english: "Very much! This was really useful." }
              ]
            }
          ]
        }
      ],

      currentConversation: null,
      currentExchangeIndex: 0,
      currentAudio: null,
      accuracyScores: [],
      conversationPath: [], // Track which exchanges were visited
      usedConversationGroups: [], // Track which conversation groups have been used in this session
      sessionQuestionAccuracy: {}, // Track accuracy for each question: { 'group-id-exchange-idx': [scores] }
      isProcessing: false,
      awaitingRetry: false,
      processingTimeout: null, // Store timeout ID for cleanup
      progressMode: 'flow', // 'flow' or 'steps' - default is flow mode
      awaitingContinue: false, // Whether we're waiting for user to click continue
      progressTimeout: null, // Store progress timeout to clear when switching modes
      savedExchangeIndex: null, // Store exchange index before processing answer (for retry)
      backgroundMusic: null, // Background music audio element
      inConversationMode: false, // Track whether user is in conversation or on initial screen
      musicEnabled: false, // Whether background music is playing
      musicManuallySet: false, // Track if user manually changed music state

      async init() {
        console.log('[DutchApp] Initializing...');

        // Initialize Vosk
        try {
          document.getElementById('loading-text').textContent = 'Loading Dutch model...';
          await VoskRecognizer.init(
            this.onSpeechResult.bind(this),
            this.onSpeechPartial.bind(this)
          );
          console.log('[DutchApp] ‚úì Vosk initialized');
        } catch (error) {
          console.error('[DutchApp] Vosk initialization failed:', error);
          
          // Show user-friendly error message
          const errorMessage = error.userMessage || '‚ùå Failed to initialize. Please refresh and try again.';
          document.getElementById('loading-text').textContent = 'Initialization Failed';
          document.getElementById('loading-error').textContent = errorMessage;
          document.getElementById('loading-error').style.display = 'block';
          document.getElementById('retry-btn').style.display = 'block';
          document.querySelector('.spinner').style.display = 'none';
          
          // Show microphone help for permission errors
          if (error.name === 'NotAllowedError') {
            document.getElementById('mic-help').style.display = 'block';
          }
          
          return;
        }

        // Initialize visualizer
        AudioVisualizer.init();

        // Setup controller events
        this.setupControllers();

        // Hide loading screen
        document.getElementById('loading-screen').classList.add('hidden');

        // Show start button (A-Frame entity, not CSS3D)
        this.showUIElement('ui-start');
        this.showUIElement('ui-controls-row');

        // Setup click handler for start button
        const startBox = document.querySelector('#ui-start .clickable');
        if (startBox) {
          startBox.addEventListener('click', () => {
            console.log('[DutchApp] Start button clicked');
            this.startExperience();
          });
        }
        
        // Setup mode toggle buttons
        this.setupModeToggle();
        
        // Setup music toggle buttons
        this.setupMusicToggle();
        
        // Setup menu button
        this.setupMenuButton();
        
        // Setup background music (but don't play yet)
        this.setupBackgroundMusic();

        console.log('[DutchApp] ‚úì Initialization complete - waiting for user to start');
      },
      
      setupModeToggle() {
        const modeToggleButton = document.getElementById('mode-toggle-button');
        
        if (modeToggleButton) {
          modeToggleButton.addEventListener('click', () => {
            // Toggle between steps and flow
            const newMode = this.progressMode === 'flow' ? 'steps' : 'flow';
            console.log(`[DutchApp] Switching to ${newMode} mode`);
            this.setProgressMode(newMode);
          });
        }
        
        console.log('[DutchApp] ‚úì Mode toggle set up');
      },
      
      setProgressMode(mode) {
        this.progressMode = mode;
        
        const bg = document.getElementById('mode-toggle-button-bg');
        const text = document.getElementById('mode-toggle-text');
        
        if (mode === 'steps') {
          // Steps mode - show "Mode: Steps"
          if (bg) {
            bg.setAttribute('color', '#E1E9E9');
            bg.setAttribute('opacity', '0.8');
          }
          if (text) {
            text.setAttribute('value', 'Mode: Steps');
            text.setAttribute('color', '#000000');
          }
        } else {
          // Flow mode - show "Mode: Flow"
          if (bg) {
            bg.setAttribute('color', '#E1E9E9');
            bg.setAttribute('opacity', '0.8');
          }
          if (text) {
            text.setAttribute('value', 'Mode: Flow');
            text.setAttribute('color', '#000000');
          }
        }
        
        console.log(`[DutchApp] Progress mode set to: ${mode}`);
      },
      
      setupBackgroundMusic() {
        this.backgroundMusic = new Audio('assets/audio/10min-suspense-background-for-voiceover-429711.mp3');
        this.backgroundMusic.loop = true;
        this.backgroundMusic.volume = 0.15; // Keep it subtle (15% volume)
        
        console.log('[DutchApp] ‚úì Background music loaded (off by default)');
      },
      
      setupMusicToggle() {
        const musicToggleButton = document.getElementById('music-toggle-button');
        
        if (musicToggleButton) {
          musicToggleButton.addEventListener('click', () => {
            console.log('[DutchApp] Music toggle clicked');
            this.musicManuallySet = true; // User manually changed music
            this.toggleMusic(!this.musicEnabled);
          });
        }
        
        console.log('[DutchApp] ‚úì Music toggle set up');
      },
      
      toggleMusic(enable) {
        if (!this.backgroundMusic) {
          this.setupBackgroundMusic();
        }
        
        this.musicEnabled = enable;
        
        if (enable) {
          this.backgroundMusic.play().catch(e => {
            console.warn('[DutchApp] Music playback failed:', e);
          });
          console.log('[DutchApp] Background music ON');
        } else {
          this.backgroundMusic.pause();
          console.log('[DutchApp] Background music OFF');
        }
        
        // Update button appearance
        const button = document.getElementById('music-toggle-button');
        const bg = document.getElementById('music-toggle-button-bg');
        const text = document.getElementById('music-toggle-text');
        
        if (enable) {
          // Music is ON
          if (bg) {
            bg.setAttribute('color', '#E1E9E9');
            bg.setAttribute('opacity', '0.8');
          }
          if (text) {
            text.setAttribute('value', 'Music: On');
            text.setAttribute('color', '#000000');
          }
        } else {
          // Music is OFF
          if (bg) {
            bg.setAttribute('color', '#E1E9E9');
            bg.setAttribute('opacity', '0.8');
          }
          if (text) {
            text.setAttribute('value', 'Music: Off');
            text.setAttribute('color', '#666666');
          }
        }
      },

      setupMenuButton() {
        const menuButton = document.getElementById('ui-menu-button');
        
        if (menuButton) {
          menuButton.addEventListener('click', () => {
            console.log('[DutchApp] Menu button clicked - returning to initial screen');
            this.returnToInitialScreen();
          });
        }
        
        console.log('[DutchApp] ‚úì Menu button set up');
      },

      returnToInitialScreen() {
        // Set mode flag
        this.inConversationMode = false;
        
        // Hide menu button
        this.hideUIElement('ui-menu-button');
        
        // Hide all conversation UI elements and remove clickable classes
        const conversationElements = [
          'ui-question', 'ui-answer1', 'ui-answer2', 'ui-answer3',
          'ui-instructions', 'ui-mic-viz', 'ui-recognition-result',
          'ui-final-score'
        ];
        
        conversationElements.forEach(elementId => {
          this.hideUIElement(elementId);
          const element = document.getElementById(elementId);
          if (element) {
            const clickables = element.querySelectorAll('.clickable');
            clickables.forEach(clickable => {
              clickable.classList.remove('clickable');
              clickable.setAttribute('visible', false);
            });
          }
        });
        
        // Reset processing flags but keep conversation state
        this.isProcessing = false;
        this.awaitingRetry = false;
        this.awaitingContinue = false;
        
        // Clear any timeouts
        if (this.processingTimeout) {
          clearTimeout(this.processingTimeout);
          this.processingTimeout = null;
        }
        if (this.progressTimeout) {
          clearTimeout(this.progressTimeout);
          this.progressTimeout = null;
        }
        
        // Keep: currentConversation, currentExchangeIndex, accuracyScores, conversationPath
        
        // Fade in initial screen elements
        const logoEl = document.getElementById('ui-logo');
        const titleBgEl = document.getElementById('ui-title-bg');
        const titleEl = document.getElementById('ui-title');
        
        // Show and fade in elements
        if (logoEl) {
          logoEl.setAttribute('visible', true);
          const logoSticks = logoEl.querySelectorAll('a-box');
          const logoImage = logoEl.querySelector('a-image');
          
          logoSticks.forEach(stick => {
            stick.removeAttribute('animation__fadein');
            stick.removeAttribute('animation__fadeout');
            setTimeout(() => {
              stick.setAttribute('animation__fadein', 'property: components.material.material.opacity; from: 0; to: 1; dur: 1000; easing: easeInOutQuad');
            }, 50);
          });
          
          if (logoImage) {
            logoImage.removeAttribute('animation__fadein');
            logoImage.removeAttribute('animation__fadeout');
            setTimeout(() => {
              logoImage.setAttribute('animation__fadein', 'property: components.material.material.opacity; from: 0; to: 1; dur: 1000; easing: easeInOutQuad');
            }, 50);
          }
        }
        
        if (titleBgEl) {
          titleBgEl.setAttribute('visible', true);
          const sphere = titleBgEl.querySelector('a-sphere');
          if (sphere) {
            sphere.removeAttribute('animation__fadein');
            sphere.removeAttribute('animation__fadeout');
            setTimeout(() => {
              sphere.setAttribute('animation__fadein', 'property: components.material.material.opacity; from: 0; to: 0.85; dur: 1000; easing: easeInOutQuad');
            }, 50);
          }
        }
        
        if (titleEl) {
          titleEl.setAttribute('visible', true);
          const titleImage = titleEl.querySelector('a-image');
          if (titleImage) {
            titleImage.removeAttribute('animation__fadein');
            titleImage.removeAttribute('animation__fadeout');
            setTimeout(() => {
              titleImage.setAttribute('animation__fadein', 'property: components.material.material.opacity; from: 0; to: 1; dur: 1000; easing: easeInOutQuad');
            }, 50);
          }
        }
        
        // Show Mode and Music buttons (controls row) with fade in after delay
        setTimeout(() => {
          const controlsRowEl = document.getElementById('ui-controls-row');
          if (controlsRowEl) {
            controlsRowEl.setAttribute('opacity', '0');
            this.showUIElement('ui-controls-row');
            controlsRowEl.removeAttribute('animation__fadein');
            controlsRowEl.removeAttribute('animation__fadeout');
            setTimeout(() => {
              controlsRowEl.setAttribute('animation__fadein', 'property: opacity; from: 0; to: 1; dur: 1000; easing: easeInOutQuad');
            }, 50);
          }
        }, 1000);
        
        // Show and restore start button after fade in
        setTimeout(() => {
          // Re-enable start button clickability and event listener
          const startButton = document.getElementById('ui-start');
          if (startButton) {
            startButton.setAttribute('opacity', '0');
            this.showUIElement('ui-start');
            
            // Fade in start button
            startButton.removeAttribute('animation__fadein');
            startButton.removeAttribute('animation__fadeout');
            setTimeout(() => {
              startButton.setAttribute('animation__fadein', 'property: opacity; from: 0; to: 1; dur: 1000; easing: easeInOutQuad');
            }, 50);
            
            const clickableBox = startButton.querySelector('a-box');
            if (clickableBox) {
              clickableBox.classList.add('clickable');
              clickableBox.setAttribute('visible', true);
              
              // Re-attach click event listener
              const newClickableBox = clickableBox.cloneNode(true);
              clickableBox.parentNode.replaceChild(newClickableBox, clickableBox);
              
              newClickableBox.addEventListener('click', () => {
                console.log('[DutchApp] Start button clicked');
                this.startExperience();
              });
            }
          }
        }, 1000);
        
        console.log('[DutchApp] Returned to initial screen');
      },

      startExperience() {
        console.log('[DutchApp] User clicked Start - beginning conversation');
        
        // Auto-start background music only if user hasn't manually set it
        if (!this.musicManuallySet) {
        this.toggleMusic(true);
        }
        
        // Fade out start button
        const startButton = document.getElementById('ui-start');
        if (startButton) {
          startButton.removeAttribute('animation__fadein');
          startButton.removeAttribute('animation__fadeout');
          setTimeout(() => {
            startButton.setAttribute('animation__fadeout', 'property: opacity; from: 1; to: 0; dur: 1000; easing: easeInOutQuad');
          }, 50);
          
          const clickableBox = startButton.querySelector('.clickable');
          if (clickableBox) {
            clickableBox.classList.remove('clickable');
            clickableBox.setAttribute('visible', false);
          }
        }
        
        // Fade out logo, title background sphere, and title
        const logoEl = document.getElementById('ui-logo');
        const titleBgEl = document.getElementById('ui-title-bg');
        const titleEl = document.getElementById('ui-title');
        
        // Fade out all child elements
        if (logoEl) {
          const logoSticks = logoEl.querySelectorAll('a-box');
          const logoImage = logoEl.querySelector('a-image');
          
          logoSticks.forEach(stick => {
            stick.removeAttribute('animation__fadein');
            stick.removeAttribute('animation__fadeout');
            setTimeout(() => {
              stick.setAttribute('animation__fadeout', 'property: components.material.material.opacity; from: 1; to: 0; dur: 1000; easing: easeInOutQuad');
            }, 50);
          });
          
          if (logoImage) {
            logoImage.removeAttribute('animation__fadein');
            logoImage.removeAttribute('animation__fadeout');
            setTimeout(() => {
              logoImage.setAttribute('animation__fadeout', 'property: components.material.material.opacity; from: 1; to: 0; dur: 1000; easing: easeInOutQuad');
            }, 50);
          }
        }
        if (titleBgEl) {
          const sphere = titleBgEl.querySelector('a-sphere');
          if (sphere) {
            sphere.removeAttribute('animation__fadein');
            sphere.removeAttribute('animation__fadeout');
            setTimeout(() => {
              sphere.setAttribute('animation__fadeout', 'property: components.material.material.opacity; from: 0.85; to: 0; dur: 1000; easing: easeInOutQuad');
            }, 50);
          }
        }
        if (titleEl) {
          const titleImage = titleEl.querySelector('a-image');
          if (titleImage) {
            titleImage.removeAttribute('animation__fadein');
            titleImage.removeAttribute('animation__fadeout');
            setTimeout(() => {
              titleImage.setAttribute('animation__fadeout', 'property: components.material.material.opacity; from: 1; to: 0; dur: 1000; easing: easeInOutQuad');
            }, 50);
          }
        }
        
        // Fade out controls row (Mode and Music buttons)
        const controlsRowEl = document.getElementById('ui-controls-row');
        if (controlsRowEl) {
          controlsRowEl.removeAttribute('animation__fadein');
          controlsRowEl.removeAttribute('animation__fadeout');
          setTimeout(() => {
            controlsRowEl.setAttribute('animation__fadeout', 'property: opacity; from: 1; to: 0; dur: 1000; easing: easeInOutQuad');
          }, 50);
        }
        
        // Hide elements after fade animation completes
        setTimeout(() => {
          this.hideUIElement('ui-start');
          this.hideUIElement('ui-logo');
          this.hideUIElement('ui-title-bg');
          this.hideUIElement('ui-title');
          
          // Hide Mode and Music buttons in conversation mode
          this.hideUIElement('ui-controls-row');
        }, 1000);
        
        // Set conversation mode flag
        this.inConversationMode = true;
        
        // Show menu button after fade out
        setTimeout(() => {
          this.showUIElement('ui-menu-button');
        }, 1000);
        
        // Start conversation after initial elements fade out (2 second delay)
        setTimeout(() => {
          // If there's a saved conversation state, resume it; otherwise start new
          if (this.currentConversation) {
            console.log('[DutchApp] Resuming conversation at exchange', this.currentExchangeIndex);
            // Reset processing state before resuming
            this.isProcessing = false;
            this.awaitingRetry = false;
            this.showNextExchange();
          } else {
        this.startConversation('random-welcome');
          }
        }, 2000);
      },

      retryInit() {
        // Reset loading screen
        document.getElementById('loading-text').textContent = 'Loading Dutch Language Model...';
        document.getElementById('loading-error').style.display = 'none';
        document.getElementById('mic-help').style.display = 'none';
        document.getElementById('retry-btn').style.display = 'none';
        document.querySelector('.spinner').style.display = 'block';
        
        // Try again
        setTimeout(() => {
          this.init();
        }, 100);
      },

      setupControllers() {
        const scene = document.querySelector('a-scene');
        
        // Wait for scene to load
        if (scene.hasLoaded) {
          this.attachControllerListeners();
        } else {
          scene.addEventListener('loaded', () => this.attachControllerListeners());
        }
      },

      attachControllerListeners() {
        const rightHand = document.getElementById('right-hand');
        
        if (!rightHand) {
          console.warn('[DutchApp] Right hand controller not found');
          return;
        }

        // Listen for trigger press (push-to-talk)
        rightHand.addEventListener('triggerdown', () => {
          // Only allow mic activation in conversation mode
          if (!this.inConversationMode) {
            return;
          }
          
          // Check if raycaster is intersecting a clickable element
          const raycaster = rightHand.components.raycaster;
          if (raycaster && raycaster.intersectedEls && raycaster.intersectedEls.length > 0) {
            const intersected = raycaster.intersectedEls[0];
            if (intersected.classList.contains('clickable')) {
              console.log('[DutchApp] Trigger pressed on clickable - skipping mic');
              return; // Don't start mic, let the click happen
            }
          }
          
          console.log('[DutchApp] Trigger pressed - starting mic');
          this.startListening();
        });

        rightHand.addEventListener('triggerup', () => {
          // Only stop listening if we were actually listening
          if (VoskRecognizer.isListening) {
            console.log('[DutchApp] Trigger released - stopping mic');
            this.stopListening();
          }
        });

        console.log('[DutchApp] ‚úì Controller listeners attached');
        
        // Add keyboard listeners for PC testing (50% accuracy answers)
        this.setupKeyboardTesting();
      },
      
      setupKeyboardTesting() {
        // Listen for keyboard keys 1, 2, 3 to trigger answers with 50% accuracy
        document.addEventListener('keydown', (e) => {
          // Check if we're in a conversation and not processing
          if (!this.currentConversation || this.isProcessing) return;
          
          // Check if key is 1, 2, or 3
          const answerIndex = parseInt(e.key) - 1;
          if (answerIndex < 0 || answerIndex > 2) return;
          
          const exchange = this.currentConversation.exchanges[this.currentExchangeIndex];
          if (!exchange || !exchange.answers[answerIndex]) return;
          
          // Get the correct answer
          const correctAnswer = exchange.answers[answerIndex].dutch;
          
          // Generate a 50% accurate version by slightly corrupting the text
          const corrupted50Percent = this.corruptTextTo50Percent(correctAnswer);
          
          console.log(`[DutchApp] Keyboard test: Key ${e.key} pressed`);
          console.log(`[DutchApp] Correct answer: "${correctAnswer}"`);
          console.log(`[DutchApp] Simulating 50% accuracy: "${corrupted50Percent}"`);
          
          // Simulate the speech recognition result
          this.evaluateAnswer(corrupted50Percent);
        });
        
        console.log('[DutchApp] ‚úì Keyboard testing enabled (keys 1, 2, 3 = 50% accuracy answers)');
      },
      
      corruptTextTo50Percent(text) {
        // Create a version of the text that will score around 50% similarity
        // Strategy: Keep roughly half the characters correct
        const words = text.split(' ');
        const corruptedWords = words.map((word, index) => {
          // Corrupt every other word more heavily
          if (index % 2 === 0) {
            // Keep this word mostly intact (small change)
            if (word.length > 3) {
              return word.slice(0, -2) + word.slice(-1);
            }
            return word;
          } else {
            // Corrupt this word more heavily
            if (word.length > 2) {
              // Remove middle characters
              return word[0] + word.slice(Math.floor(word.length / 2));
            }
            return word;
          }
        });
        
        return corruptedWords.join(' ');
      },

      startConversation(conversationId) {
        // Ensure final score screen is completely hidden and disabled
        const finalScore = document.getElementById('ui-final-score');
        if (finalScore) {
          finalScore.setAttribute('visible', false);
          const clickableBoxes = finalScore.querySelectorAll('.clickable');
          clickableBoxes.forEach(box => {
            box.classList.remove('clickable');
            box.setAttribute('visible', false);
          });
        }
        
        // If conversationId is 'random-welcome', select a random welcome question
        if (conversationId === 'random-welcome') {
          const welcomeConversations = this.conversations.filter(c => c.isWelcome === true);
          const randomIndex = Math.floor(Math.random() * welcomeConversations.length);
          this.currentConversation = welcomeConversations[randomIndex];
          console.log('[DutchApp] Selected random welcome:', this.currentConversation.id);
        } else {
          this.currentConversation = this.conversations.find(c => c.id === conversationId);
        }
        
        this.currentExchangeIndex = 0;
        this.accuracyScores = [];
        this.conversationPath = []; // Reset path tracking for this conversation
        
        console.log('[DutchApp] Starting conversation:', this.currentConversation.name);
        this.showNextExchange();
      },

      selectNextConversationGroup() {
        // Get all non-welcome conversation groups that haven't been used yet
        const availableGroups = this.conversations.filter(c => 
          c.isWelcome === false && 
          !c.isLegacy &&
          !this.usedConversationGroups.includes(c.id)
        );
        
        // If all groups have been used, reset the list
        if (availableGroups.length === 0) {
          console.log('[DutchApp] All groups used, resetting...');
          this.usedConversationGroups = [];
          // Get all groups again
          const allGroups = this.conversations.filter(c => 
            c.isWelcome === false && 
            !c.isLegacy
          );
          const randomIndex = Math.floor(Math.random() * allGroups.length);
          return allGroups[randomIndex].id;
        }
        
        // Select a random available group
        const randomIndex = Math.floor(Math.random() * availableGroups.length);
        const selectedGroup = availableGroups[randomIndex];
        
        // Mark this group as used
        this.usedConversationGroups.push(selectedGroup.id);
        console.log('[DutchApp] Selected next group:', selectedGroup.id);
        console.log('[DutchApp] Used groups so far:', this.usedConversationGroups);
        
        return selectedGroup.id;
      },

      showNextExchange() {
        // Clear any pending progress timeout
        if (this.progressTimeout) {
          clearTimeout(this.progressTimeout);
          this.progressTimeout = null;
        }
        
        // Hide action buttons if they're showing
        const retryBtn = document.getElementById('retry-answer-button');
        const continueBtn = document.getElementById('continue-button');
        if (retryBtn) retryBtn.setAttribute('visible', false);
        if (continueBtn) continueBtn.setAttribute('visible', false);
        this.awaitingContinue = false;
        
        if (this.currentExchangeIndex >= this.currentConversation.exchanges.length) {
          // End of current conversation
          if (this.currentConversation.isWelcome) {
            // Welcome question complete - transition to a conversation group
            console.log('[DutchApp] Welcome complete, transitioning to conversation group...');
            const nextGroupId = this.selectNextConversationGroup();
            
            // Show a brief transition message (optional)
            setTimeout(() => {
              this.startConversation(nextGroupId);
            }, 1000);
          } else {
            // Regular conversation group complete - transition to next group
            console.log('[DutchApp] Conversation group complete, transitioning to next group...');
            const nextGroupId = this.selectNextConversationGroup();
            
            // Show brief success message before transitioning
            setTimeout(() => {
              this.startConversation(nextGroupId);
            }, 1500);
          }
          return;
        }

        // Track this exchange in the path
        this.conversationPath.push(this.currentExchangeIndex);
        
        // On first exchange, fade in instructions
        if (this.currentExchangeIndex === 0) {
          const instructionsEl = document.getElementById('ui-instructions');
          if (instructionsEl) {
            instructionsEl.setAttribute('opacity', '0');
            this.showUIElement('ui-instructions');
            
            setTimeout(() => {
              const instructionsElNow = document.getElementById('ui-instructions');
              if (instructionsElNow) {
                instructionsElNow.removeAttribute('animation__fadein');
                instructionsElNow.removeAttribute('animation__fadeout');
                setTimeout(() => {
                  instructionsElNow.setAttribute('animation__fadein', 'property: opacity; from: 0; to: 1; dur: 1000; easing: easeInOutQuad');
                }, 50);
              }
            }, 2000);
          }
        }

        const exchange = this.currentConversation.exchanges[this.currentExchangeIndex];
        
        // Show question using A-Frame text
        const questionNL = document.getElementById('question-text-nl');
        const questionENContainer = document.getElementById('question-text-en-container');
        const questionEN = document.getElementById('question-text-en');
        if (questionNL) questionNL.setAttribute('value', exchange.question.dutch);
        if (questionEN) {
          questionEN.setAttribute('value', exchange.question.english);
        }
        if (questionENContainer) {
          questionENContainer.setAttribute('visible', false);
        }
        
        // Setup hover and click for question panel (remove old listeners first)
        const questionPanel = document.getElementById('ui-question');
        if (questionPanel) {
          // Remove old event listeners by cloning the node
          const newQuestionPanel = questionPanel.cloneNode(true);
          questionPanel.parentNode.replaceChild(newQuestionPanel, questionPanel);
          
          // Re-get the container after cloning
          const newQuestionENContainer = document.getElementById('question-text-en-container');
          
          // Ensure clickable box exists and has clickable class
          const clickableBox = newQuestionPanel.querySelector('a-box');
          if (clickableBox) {
            clickableBox.classList.add('clickable');
            clickableBox.setAttribute('visible', true);
          }
          
          // Add hover listener to show/hide translation tooltip
          newQuestionPanel.addEventListener('raycaster-intersected', () => {
            if (newQuestionENContainer) newQuestionENContainer.setAttribute('visible', true);
          });
          newQuestionPanel.addEventListener('raycaster-intersected-cleared', () => {
            if (newQuestionENContainer) newQuestionENContainer.setAttribute('visible', false);
          });
          
          // Add click listener to replay audio
          newQuestionPanel.addEventListener('click', () => {
            console.log('[DutchApp] Question clicked - replaying audio');
            this.playQuestionAudio(exchange.question.audio);
          });
          
          // Set initial opacity to 0 for fade in
          newQuestionPanel.setAttribute('opacity', '0');
        }
        
        this.showUIElement('ui-question');
        
        // Fade in question after delay
        setTimeout(() => {
          const questionPanelNow = document.getElementById('ui-question');
          if (questionPanelNow) {
            questionPanelNow.removeAttribute('animation__fadein');
            questionPanelNow.removeAttribute('animation__fadeout');
            setTimeout(() => {
              questionPanelNow.setAttribute('animation__fadein', 'property: opacity; from: 0; to: 1; dur: 1000; easing: easeInOutQuad');
            }, 50);
          }
        }, 2000);

        // Show answer choices using A-Frame text
        for (let i = 0; i < 3; i++) {
          const answerText = document.getElementById(`answer${i+1}-text`);
          const answerEN = document.getElementById(`answer${i+1}-en`);
          const answerENContainer = document.getElementById(`answer${i+1}-en-container`);
          const answerPanel = document.getElementById(`ui-answer${i+1}`);
          
          if (answerText && exchange.answers[i]) {
            answerText.setAttribute('value', exchange.answers[i].dutch);
          }
          if (answerEN && exchange.answers[i]) {
            answerEN.setAttribute('value', exchange.answers[i].english);
          }
          if (answerENContainer) {
            answerENContainer.setAttribute('visible', false);
          }
          
          // Remove old listeners by cloning
          if (answerPanel) {
            const newAnswerPanel = answerPanel.cloneNode(true);
            answerPanel.parentNode.replaceChild(newAnswerPanel, answerPanel);
            
            // Ensure clickable box has clickable class after cloning
            const clickableBox = newAnswerPanel.querySelector('.answer-card');
            if (clickableBox) {
              clickableBox.classList.add('clickable');
              clickableBox.setAttribute('visible', true);
              clickableBox.setAttribute('opacity', 0);
            }
            
            // Re-get container reference after cloning
            const newAnswerENContainer = newAnswerPanel.querySelector(`#answer${i+1}-en-container`);
            const newAnswerBestScore = newAnswerPanel.querySelector(`#answer${i+1}-best-score`);
            
            // Update best score display AFTER cloning
            if (newAnswerBestScore && exchange.answers[i]) {
              const answerKey = `answer-${this.currentConversation.id}-ex${this.currentExchangeIndex}-opt${i+1}`;
              const storedScore = localStorage.getItem(answerKey);
              
              if (storedScore) {
                newAnswerBestScore.setAttribute('value', storedScore);
                newAnswerBestScore.setAttribute('visible', true);
                console.log(`[DutchApp] Showing best score ${storedScore} for answer ${i+1}`);
              } else {
                newAnswerBestScore.setAttribute('visible', false);
              }
            }
            
            // Add hover listener to show/hide tooltip
            newAnswerPanel.addEventListener('raycaster-intersected', () => {
              if (newAnswerENContainer) newAnswerENContainer.setAttribute('visible', true);
            });
            newAnswerPanel.addEventListener('raycaster-intersected-cleared', () => {
              if (newAnswerENContainer) newAnswerENContainer.setAttribute('visible', false);
            });
            
            // Add click listener to play answer audio
            newAnswerPanel.addEventListener('click', () => {
              const answer = exchange.answers[i];
              if (answer) {
                // Generate audio filename if not explicitly set
                let audioPath = answer.audio;
                if (!audioPath) {
                  // Auto-generate filename: answers/ans_ex{exchangeIndex}_opt{optionNumber}.mp3
                  const filename = `ans_ex${this.currentExchangeIndex}_opt${i+1}`;
                  audioPath = `assets/audio/nl/meetup/answers/${filename}.mp3`;
                }
                console.log('[DutchApp] Answer clicked - playing audio:', audioPath);
                this.playQuestionAudio(audioPath);
              }
            });
            
            // Set initial opacity to 0 for fade in
            newAnswerPanel.setAttribute('opacity', '0');
          }
          
          this.showUIElement(`ui-answer${i+1}`);
          
          // Fade in answer after delay (capture i in closure)
          setTimeout(((index) => {
            return () => {
              const answerEntityNow = document.getElementById(`ui-answer${index+1}`);
              if (answerEntityNow) {
                answerEntityNow.removeAttribute('animation__fadein');
                answerEntityNow.removeAttribute('animation__fadeout');
                setTimeout(() => {
                  answerEntityNow.setAttribute('animation__fadein', 'property: opacity; from: 0; to: 1; dur: 1000; easing: easeInOutQuad');
                }, 50);
              }
            };
          })(i), 2000);
        }

        // Play question audio (delayed to sync with fade in)
        setTimeout(() => {
        this.playQuestionAudio(exchange.question.audio);
        }, 2000);

        // Reset state
        this.isProcessing = false;
        this.awaitingRetry = false;
      },

      renderAnswerChoices(answers) {
        const container = document.getElementById('answer-choices');
        container.innerHTML = '';

        answers.forEach((answer, index) => {
          const card = document.createElement('div');
          card.className = 'answer-card clickable';
          card.innerHTML = `
            <div class="answer-dutch">${answer.dutch}</div>
            <div class="answer-english">${answer.english}</div>
          `;
          container.appendChild(card);
        });
      },

      playQuestionAudio(audioUrl) {
        if (this.currentAudio) {
          this.currentAudio.pause();
        }

        this.currentAudio = new Audio(audioUrl);
        this.currentAudio.play().catch(e => {
          console.warn('[DutchApp] Audio playback failed:', e);
        });
      },

      repeatQuestion() {
        const exchange = this.currentConversation.exchanges[this.currentExchangeIndex];
        this.playQuestionAudio(exchange.question.audio);
      },

      startListening() {
        if (this.isProcessing || !VoskRecognizer.isInitialized) return;

        console.log('[DutchApp] Starting listening...');
        
        // Hide instructions, show mic visualization
        this.hideUIElement('ui-instructions');
        this.showUIElement('ui-mic-viz');
        
        VoskRecognizer.start(); // This sets shouldProcessResults = true
        AudioVisualizer.start();
      },

      stopListening() {
        if (!VoskRecognizer.isListening) return;

        console.log('[DutchApp] Stopping recording (waiting for result)...');
        VoskRecognizer.stopRecording(); // Stop recording but keep processing
        AudioVisualizer.stop();
        
        // Check if result was already processed (Vosk auto-finalized)
        if (!VoskRecognizer.shouldProcessResults) {
          console.log('[DutchApp] Result already processed, skipping processing screen');
          return; // Don't show processing screen if result already came in
        }
        
        // Show "Processing..." indicator only if we're still waiting for a result
        const micEl = document.getElementById('ui-mic-viz');
        if (micEl) {
          micEl.setAttribute('visible', true);
          const micText = micEl.querySelector('a-text');
          if (micText) micText.setAttribute('value', '‚è≥ Processing...');
        }
        
        // Clear any existing timeout
        if (this.processingTimeout) {
          clearTimeout(this.processingTimeout);
          this.processingTimeout = null;
        }
        
        // Disable processing after 3 seconds if no result came through
        // (Handles edge case where final result never arrives)
        this.processingTimeout = setTimeout(() => {
          if (VoskRecognizer.shouldProcessResults) {  // Removed "&& !VoskRecognizer.isListening" check
            VoskRecognizer.shouldProcessResults = false;
            console.log('[DutchApp] Processing timeout - disabled');
            if (micEl) micEl.setAttribute('visible', false);
            const instructionsEl = document.getElementById('ui-instructions');
            if (instructionsEl) instructionsEl.setAttribute('visible', true);
            this.isProcessing = false; // Reset processing flag
          }
          this.processingTimeout = null;
        }, 3000); // Increased to 3 seconds
      },

      onSpeechPartial(text) {
        console.log('[DutchApp] Partial:', text);
        
        // Reset the processing timeout since Vosk is actively processing
        // Clear existing timeout
        if (this.processingTimeout) {
          clearTimeout(this.processingTimeout);
        }
        
        // Set a new timeout - if no more activity for 3 seconds, cleanup
        const micEl = document.getElementById('ui-mic-viz');
        this.processingTimeout = setTimeout(() => {
          if (VoskRecognizer.shouldProcessResults) {  // Removed "&& !VoskRecognizer.isListening" check
            VoskRecognizer.shouldProcessResults = false;
            console.log('[DutchApp] Processing timeout (from partial) - disabled');
            if (micEl) micEl.setAttribute('visible', false);
            const instructionsEl = document.getElementById('ui-instructions');
            if (instructionsEl) instructionsEl.setAttribute('visible', true);
            this.isProcessing = false; // Reset processing flag
          }
          this.processingTimeout = null;
        }, 3000); // 3 seconds of inactivity
      },

      onSpeechResult(text) {
        console.log('[DutchApp] Final result:', text);
        
        // Clear the processing timeout since we got a result
        if (this.processingTimeout) {
          clearTimeout(this.processingTimeout);
          this.processingTimeout = null;
        }
        
        // Hide processing indicator and show instructions
        const micEl = document.getElementById('ui-mic-viz');
        if (micEl) micEl.setAttribute('visible', false);
        const instructionsEl = document.getElementById('ui-instructions');
        if (instructionsEl) instructionsEl.setAttribute('visible', true);
        
        // Disable processing immediately - we got a result (even if empty)
        VoskRecognizer.shouldProcessResults = false;
        
        if (!text || text.trim() === '') {
          console.warn('[DutchApp] Empty result (silence or too short), ignoring');
          this.isProcessing = false;
          return;
        }
        
        this.evaluateAnswer(text);
      },

      evaluateAnswer(spokenText) {
        this.isProcessing = true;
        
        // Save current exchange index BEFORE evaluating (for retry functionality)
        this.savedExchangeIndex = this.currentExchangeIndex;
        
        const exchange = this.currentConversation.exchanges[this.currentExchangeIndex];
        
        // Calculate similarity to each answer (include branch info)
        const similarities = exchange.answers.map((answer, index) => ({
          answer: answer.dutch,
          score: calculateSimilarity(spokenText, answer.dutch),
          branch: answer.branch !== undefined ? answer.branch : null,
          answerIndex: index
        }));

        // Find best match
        const bestMatch = similarities.reduce((best, current) => 
          current.score > best.score ? current : best
        );

        console.log('[DutchApp] Best match:', bestMatch);

        // Track accuracy for this specific question (for session history)
        const questionKey = `${this.currentConversation.id}-ex${this.currentExchangeIndex}`;
        if (!this.sessionQuestionAccuracy[questionKey]) {
          this.sessionQuestionAccuracy[questionKey] = [];
        }
        this.sessionQuestionAccuracy[questionKey].push(bestMatch.score);

        // Show result in VR UI
        const recognitionText = document.getElementById('recognition-text');
        const accuracyText = document.getElementById('accuracy-text');
        
        if (recognitionText) {
          recognitionText.setAttribute('value', `You said: "${spokenText}"`);
        }
        if (accuracyText) {
          const color = bestMatch.score >= 60 ? '#4CAF50' : '#FF5252';
          
          // Show current score and previous attempts if any
          const attempts = this.sessionQuestionAccuracy[questionKey];
          let displayText = `Accuracy: ${bestMatch.score}%`;
          if (attempts.length > 1) {
            const prevScores = attempts.slice(0, -1).join('%, ');
            displayText += ` (Previous: ${prevScores}%)`;
          }
          
          accuracyText.setAttribute('value', displayText);
          accuracyText.setAttribute('color', color);
        }
        
        // Hide instructions when showing result
        this.hideUIElement('ui-instructions');
        this.showUIElement('ui-recognition-result');
        
        // Determine if answer is acceptable
        const threshold = this.awaitingRetry ? 0 : 60; // Lower threshold on retry
        
        if (bestMatch.score >= threshold) {
          // Accept answer and move on
          this.accuracyScores.push(bestMatch.score);
          
          // Store best score for this answer
          const answerKey = `answer-${this.currentConversation.id}-ex${this.currentExchangeIndex}-opt${bestMatch.answerIndex + 1}`;
          const storedScore = localStorage.getItem(answerKey);
          
          if (!storedScore || bestMatch.score > parseInt(storedScore)) {
            localStorage.setItem(answerKey, bestMatch.score);
            console.log(`[DutchApp] New best score for answer ${bestMatch.answerIndex + 1}: ${bestMatch.score}%`);
          }
          
          // Check if this answer leads to a branch
          if (bestMatch.branch !== null) {
            // Branch to specific exchange
            this.currentExchangeIndex = bestMatch.branch;
            console.log(`[DutchApp] Branching to exchange ${bestMatch.branch}`);
          } else {
            // No branch - move to next exchange sequentially
            this.currentExchangeIndex++;
          }
          
          this.awaitingRetry = false;
          
          // Clear any existing progress timeout
          if (this.progressTimeout) {
            clearTimeout(this.progressTimeout);
            this.progressTimeout = null;
          }
          
          // Check progress mode
          if (this.progressMode === 'steps') {
            // Steps mode - keep result visible and show action buttons immediately
            this.showActionButtons();
          } else {
            // Flow mode - hide result after 3 seconds and automatically continue
            this.progressTimeout = setTimeout(() => {
              this.hideUIElement('ui-recognition-result');
              this.showUIElement('ui-instructions');
              this.showNextExchange();
              this.progressTimeout = null;
            }, 3000);
          }
        } else if (!this.awaitingRetry) {
          // First time failing - ask for retry
          this.awaitingRetry = true;
          this.isProcessing = false;
          setTimeout(() => {
            if (recognitionText) recognitionText.setAttribute('value', 'Try again!');
            if (accuracyText) {
              accuracyText.setAttribute('value', 'Hold trigger and speak clearly');
              accuracyText.setAttribute('color', '#FFD700');
            }
            this.showUIElement('ui-recognition-result');
            setTimeout(() => {
              this.hideUIElement('ui-recognition-result');
              this.showUIElement('ui-instructions');
            }, 2000);
          }, 3000);
        } else {
          // Second attempt - accept and move on anyway
          this.accuracyScores.push(bestMatch.score);
          
          // Check if this answer leads to a branch
          if (bestMatch.branch !== null) {
            this.currentExchangeIndex = bestMatch.branch;
            console.log(`[DutchApp] Branching to exchange ${bestMatch.branch} (retry)`);
          } else {
            this.currentExchangeIndex++;
          }
          
          this.awaitingRetry = false;
          
          // Clear any existing progress timeout
          if (this.progressTimeout) {
            clearTimeout(this.progressTimeout);
            this.progressTimeout = null;
          }
          
          // Check progress mode
          if (this.progressMode === 'steps') {
            // Steps mode - keep result visible and show action buttons immediately
            this.showActionButtons();
          } else {
            // Flow mode - hide result and automatically continue after delay
            this.progressTimeout = setTimeout(() => {
              this.hideUIElement('ui-recognition-result');
              this.showUIElement('ui-instructions');
              this.showNextExchange();
              this.progressTimeout = null;
            }, 3000);
          }
        }
      },
      
      showActionButtons() {
        console.log('[DutchApp] Showing action buttons (Steps mode)');
        this.awaitingContinue = true;
        
        // Show the buttons that are now part of ui-recognition-result
        const retryButton = document.getElementById('retry-answer-button');
        const continueButton = document.getElementById('continue-button');
        
        // Give A-Frame a moment to update visibility before setting up listeners
        setTimeout(() => {
          // Setup click handler for retry button
          if (retryButton) {
            console.log('[DutchApp] Retry button element found, setting up click handler');
            
            // Remove old listeners by cloning
            const newRetryButton = retryButton.cloneNode(true);
            newRetryButton.setAttribute('visible', true);
            
            // Ensure the clickable box has the clickable class
            const retryClickableBox = newRetryButton.querySelector('.action-btn');
            if (retryClickableBox) {
              retryClickableBox.classList.add('clickable');
            }
            
            retryButton.parentNode.replaceChild(newRetryButton, retryButton);
            
            // Add click listener
            newRetryButton.addEventListener('click', () => {
              console.log('[DutchApp] Retry button clicked');
              const retryBtn = document.getElementById('retry-answer-button');
              const continueBtn = document.getElementById('continue-button');
              if (retryBtn) retryBtn.setAttribute('visible', false);
              if (continueBtn) continueBtn.setAttribute('visible', false);
              this.hideUIElement('ui-recognition-result');
              this.showUIElement('ui-instructions');
              this.awaitingContinue = false;
              this.isProcessing = false;
              
              // Restore the exchange index to what it was BEFORE the answer was evaluated
              if (this.savedExchangeIndex !== null) {
                console.log(`[DutchApp] Restoring exchange index from ${this.currentExchangeIndex} to ${this.savedExchangeIndex}`);
                this.currentExchangeIndex = this.savedExchangeIndex;
              }
              // Don't call showNextExchange - just hide the results so user can try again
            });
          } else {
            console.error('[DutchApp] Retry button element not found!');
          }
          
          // Setup click handler for continue button
          if (continueButton) {
            console.log('[DutchApp] Continue button element found, setting up click handler');
            
            // Remove old listeners by cloning
            const newContinueButton = continueButton.cloneNode(true);
            newContinueButton.setAttribute('visible', true);
            
            // Ensure the clickable box has the clickable class
            const continueClickableBox = newContinueButton.querySelector('.action-btn');
            if (continueClickableBox) {
              continueClickableBox.classList.add('clickable');
            }
            
            continueButton.parentNode.replaceChild(newContinueButton, continueButton);
            
            // Add click listener
            newContinueButton.addEventListener('click', () => {
              console.log('[DutchApp] Continue button clicked');
              const retryBtn = document.getElementById('retry-answer-button');
              const continueBtn = document.getElementById('continue-button');
              if (retryBtn) retryBtn.setAttribute('visible', false);
              if (continueBtn) continueBtn.setAttribute('visible', false);
              this.hideUIElement('ui-recognition-result');
              this.showUIElement('ui-instructions');
              this.awaitingContinue = false;
              this.showNextExchange();
            });
          } else {
            console.error('[DutchApp] Continue button element not found!');
          }
        }, 100);
      },

      showFinalScore() {
        // Hide ALL interactive elements and remove clickable classes to prevent ghost clicks
        
        // Hide question panel
        const questionPanel = document.getElementById('ui-question');
        if (questionPanel) {
          questionPanel.setAttribute('visible', false);
          const clickableBox = questionPanel.querySelector('.clickable');
          if (clickableBox) {
            clickableBox.classList.remove('clickable');
            clickableBox.setAttribute('visible', false);
          }
        }
        
        // Hide all answer panels and remove their clickable classes
        for (let i = 1; i <= 3; i++) {
          const answerPanel = document.getElementById(`ui-answer${i}`);
          if (answerPanel) {
            answerPanel.setAttribute('visible', false);
            const clickableBox = answerPanel.querySelector('.clickable');
            if (clickableBox) {
              clickableBox.classList.remove('clickable');
              clickableBox.setAttribute('visible', false);
            }
          }
        }
        
        // Hide action buttons (Retry/Continue) and remove clickable classes
        const retryBtn = document.getElementById('retry-answer-button');
        const continueBtn = document.getElementById('continue-button');
        if (retryBtn) {
          retryBtn.setAttribute('visible', false);
          const clickables = retryBtn.querySelectorAll('.clickable');
          clickables.forEach(box => {
            box.classList.remove('clickable');
            box.setAttribute('visible', false);
          });
        }
        if (continueBtn) {
          continueBtn.setAttribute('visible', false);
          const clickables = continueBtn.querySelectorAll('.clickable');
          clickables.forEach(box => {
            box.classList.remove('clickable');
            box.setAttribute('visible', false);
          });
        }
        
        // Hide recognition result
        this.hideUIElement('ui-recognition-result');
        
        // Hide controls row (mode and music toggles) and remove clickable classes
        const controlsRow = document.getElementById('ui-controls-row');
        if (controlsRow) {
          controlsRow.setAttribute('visible', false);
          const clickableBoxes = controlsRow.querySelectorAll('.clickable');
          clickableBoxes.forEach(box => {
            box.classList.remove('clickable');
            box.setAttribute('visible', false);
          });
        }

        // Calculate average accuracy
        const totalAccuracy = Math.round(
          this.accuracyScores.reduce((sum, score) => sum + score, 0) / this.accuracyScores.length
        );

        // Generate unique path key from the sequence of exchanges visited
        const pathKey = this.conversationPath.join('-');
        const storageKey = `best-${this.currentConversation.id}-path-${pathKey}`;
        
        // Check and update best score for this specific path
        const bestScore = localStorage.getItem(storageKey);
        const isNewBest = !bestScore || totalAccuracy > parseInt(bestScore);
        
        if (isNewBest) {
          localStorage.setItem(storageKey, totalAccuracy);
        }

        console.log('[DutchApp] Path taken:', pathKey);
        console.log('[DutchApp] Total accuracy:', totalAccuracy);
        console.log('[DutchApp] Best score for this path:', isNewBest ? totalAccuracy : bestScore);

        // Show result in VR UI
        const finalAccuracyText = document.getElementById('final-accuracy-text');
        const bestScoreText = document.getElementById('best-score-text');
        
        if (finalAccuracyText) {
          finalAccuracyText.setAttribute('value', `Overall Accuracy: ${totalAccuracy}%`);
        }
        if (bestScoreText) {
          if (isNewBest) {
            bestScoreText.setAttribute('value', 'üéâ New Personal Best for This Path!');
            bestScoreText.setAttribute('color', '#FFD700');
          } else {
            bestScoreText.setAttribute('value', `Path Best: ${bestScore}%`);
            bestScoreText.setAttribute('color', '#FFD700');
          }
        }
        
        this.showUIElement('ui-final-score');
        
        // Setup restart button with hover effect
        const restartButton = document.getElementById('restart-button');
        if (restartButton) {
          // Ensure the restart button's clickable box has the clickable class
          const clickableBox = restartButton.querySelector('.clickable');
          if (!clickableBox) {
            // If it doesn't have the class, add it back
            const box = restartButton.querySelector('a-box');
            if (box) {
              box.classList.add('clickable');
              box.setAttribute('visible', false); // Still invisible, just interactable
            }
          }
          
          // Remove old listeners by cloning
          const newRestartButton = restartButton.cloneNode(true);
          restartButton.parentNode.replaceChild(newRestartButton, restartButton);
          
          // Ensure clickable class is on the cloned button
          const newClickableBox = newRestartButton.querySelector('a-box');
          if (newClickableBox) {
            newClickableBox.classList.add('clickable');
            newClickableBox.setAttribute('visible', false);
          }
          
          // Re-get elements after cloning
          const restartBg = document.getElementById('restart-button-bg');
          const restartText = document.getElementById('restart-button-text');
          
          // Add hover effect
          newRestartButton.addEventListener('raycaster-intersected', () => {
            if (restartBg) restartBg.setAttribute('color', '#333333');
            if (restartText) restartText.setAttribute('color', '#ffffff');
          });
          newRestartButton.addEventListener('raycaster-intersected-cleared', () => {
            if (restartBg) restartBg.setAttribute('color', '#000000');
            if (restartText) restartText.setAttribute('color', '#ffffff');
          });
          
          // Add click listener
          newRestartButton.addEventListener('click', () => {
            console.log('[DutchApp] Restart button clicked');
            this.restart();
          });
        }

        console.log('[DutchApp] Conversation complete. Accuracy:', totalAccuracy);
      },

      restart() {
        this.hideUIElement('ui-final-score');
        
        // Restore controls row visibility and clickable classes
        const controlsRow = document.getElementById('ui-controls-row');
        if (controlsRow) {
          controlsRow.setAttribute('visible', true);
          const clickableBoxes = controlsRow.querySelectorAll('.mode-toggle-btn, .music-toggle-btn');
          clickableBoxes.forEach(box => {
            box.classList.add('clickable');
          });
        }
        
        this.accuracyScores = []; // Reset scores
        this.conversationPath = []; // Reset path tracking
        this.currentExchangeIndex = 0; // Reset to first exchange
        this.startConversation(this.currentConversation.id);
      }
    };

    // ============================================
    // VR LOGO ANIMATION (A-Frame)
    // ============================================
    function initVRLogo() {
      const container = document.getElementById('logo-lines-container');
      if (!container) return;

      // Create 24 sets of 3 different line types randomly distributed in 3D sphere
      for (let i = 0; i < 24; i++) {
        // Random spherical coordinates for each set
        const theta = Math.random() * Math.PI * 2; // azimuthal angle
        const phi = Math.acos(2 * Math.random() - 1); // polar angle
        
        // Random rotation angles for 3D orientation
        const rotX = Math.random() * 360;
        const rotY = Math.random() * 360;
        const rotZ = Math.random() * 360;
        
        // Thin line (darkslategrey, full height)
        const thinLine = document.createElement('a-box');
        thinLine.setAttribute('width', '0.001');
        thinLine.setAttribute('height', '0.2');
        thinLine.setAttribute('depth', '0.001');
        thinLine.setAttribute('color', '#2f4f4f');
        thinLine.setAttribute('material', 'transparent: true; opacity: 1');
        thinLine.setAttribute('position', '0 0 0');
        thinLine.setAttribute('rotation', `${rotX} ${rotY} ${rotZ}`);
        thinLine.setAttribute('animation', `property: rotation; to: ${rotX + 720} ${rotY + 720} ${rotZ + 360}; dur: 24000; easing: linear; loop: true; delay: ${i * 600}`);
        container.appendChild(thinLine);
        
        // Medium line (mediumaquamarine, 66% height) - slightly different rotation
        const rotX2 = rotX + (Math.random() * 30 - 15);
        const rotY2 = rotY + (Math.random() * 30 - 15);
        const rotZ2 = rotZ + (Math.random() * 30 - 15);
        
        const medLine = document.createElement('a-box');
        medLine.setAttribute('width', '0.003');
        medLine.setAttribute('height', '0.132');
        medLine.setAttribute('depth', '0.001');
        medLine.setAttribute('color', '#66cdaa');
        medLine.setAttribute('material', 'transparent: true; opacity: 1');
        medLine.setAttribute('position', '0 0 0');
        medLine.setAttribute('rotation', `${rotX2} ${rotY2} ${rotZ2}`);
        medLine.setAttribute('animation', `property: rotation; to: ${rotX2 + 720} ${rotY2 + 720} ${rotZ2 + 360}; dur: 16000; easing: linear; loop: true; delay: ${i * 400}`);
        container.appendChild(medLine);
        
        // Thick line (darkslategrey, 30% height) - slightly different rotation
        const rotX3 = rotX + (Math.random() * 30 - 15);
        const rotY3 = rotY + (Math.random() * 30 - 15);
        const rotZ3 = rotZ + (Math.random() * 30 - 15);
        
        const thickLine = document.createElement('a-box');
        thickLine.setAttribute('width', '0.004');
        thickLine.setAttribute('height', '0.06');
        thickLine.setAttribute('depth', '0.001');
        thickLine.setAttribute('color', '#2f4f4f');
        thickLine.setAttribute('material', 'transparent: true; opacity: 1');
        thickLine.setAttribute('position', '0 0 0');
        thickLine.setAttribute('rotation', `${rotX3} ${rotY3} ${rotZ3}`);
        thickLine.setAttribute('animation', `property: rotation; to: ${rotX3 + 720} ${rotY3 + 720} ${rotZ3 + 360}; dur: 8000; easing: linear; loop: true; delay: ${i * 200}`);
        container.appendChild(thickLine);
      }
      
      console.log('[Logo] VR logo lines created and animated as 3D sphere');
    }

    // Initialize VR logo when scene is loaded
    document.addEventListener('DOMContentLoaded', function() {
      const scene = document.querySelector('a-scene');
      if (scene.hasLoaded) {
        initVRLogo();
      } else {
        scene.addEventListener('loaded', initVRLogo);
      }
    });

    // ============================================
    // INITIALIZE ON PAGE LOAD
    // ============================================
    window.addEventListener('load', () => {
      DutchApp.init();
    });
  </script>
</body>
</html>
